<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Real-time crypto market sentiment tracker with casino-style slot machine visualization">
    <title>FGI CHAD</title>
    <!-- V6: Added BTC Dominance and Market Cap cards to right side -->

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Crypto Fear & Greed Protocol">
    <meta name="twitter:description" content="Real-time crypto market sentiment tracker with casino-style visualization">
    <meta name="twitter:image" content="https://meta-fgi.vercel.app/og-image.png">

    <!-- Open Graph -->
    <meta property="og:title" content="Crypto Fear & Greed Protocol">
    <meta property="og:description" content="Real-time crypto market sentiment tracker with casino-style slot machine visualization">
    <meta property="og:image" content="https://meta-fgi.vercel.app/og-image.png">
    <meta property="og:url" content="https://meta-fgi.vercel.app">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23f7931a%22/><text x=%2250%22 y=%2270%22 font-size=%2270%22 fill=%22white%22 text-anchor=%22middle%22 font-family=%22Arial,sans-serif%22 font-weight=%22bold%22>â‚¿</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Azeret+Mono:wght@400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Chakra Petch', monospace;
            background: #0a0e14;
            color: #e6e8eb;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(0deg, rgba(57, 255, 20, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(57, 255, 20, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
            z-index: 0;
        }

        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Radial gradient glow orbs */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 15% 20%, rgba(57, 255, 20, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 85% 80%, rgba(255, 51, 102, 0.06) 0%, transparent 50%);
            z-index: 0;
            animation: glow-pulse 8s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.15; transition: opacity 0.5s ease; }
        #matrix-canvas.hidden { opacity: 0; pointer-events: none; }
        .container { text-align: center; max-width: 1100px; width: 100%; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        
        .controls { position: fixed; top: 20px; right: 80px; display: flex; gap: 10px; z-index: 100; transition: opacity 0.3s, transform 0.3s; }
        .controls-mobile { display: none; }
        .controls.hidden { opacity: 0; transform: translateY(-100px); pointer-events: none; }
        .control-btn { background: rgba(26, 122, 10, 0.3); border: 1px solid #1a7a0a; color: #39ff14; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-family: 'Chakra Petch', monospace; font-size: 1.2em; transition: all 0.3s ease; position: relative; text-decoration: none; display: inline-block; }
        .control-btn:hover { background: rgba(57, 255, 20, 0.2); transform: scale(1.05); }
        .control-btn:hover::after { content: attr(data-tooltip); position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%); background: rgba(57, 255, 20, 0.95); color: #0a0e14; padding: 6px 12px; border-radius: 5px; font-size: 0.7em; white-space: nowrap; z-index: 1000; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); }
        .control-btn.active { background: rgba(57, 255, 20, 0.3); border-color: #39ff14; }
        .control-btn:focus-visible { outline: 3px solid #39ff14; outline-offset: 3px; box-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        .telegram-btn { background: rgba(26, 122, 10, 0.3); border-color: #1a7a0a; color: #39ff14; }
        .telegram-btn:hover { background: rgba(57, 255, 20, 0.2); color: #39ff14; }
        .telegram-btn svg { fill: currentColor; }

        /* Hindsight Button - NEW FEATURE */
        .hindsight-btn {
            background: linear-gradient(145deg, #ffaa00 0%, #ffd700 50%, #ffaa00 100%);
            border: 2px solid #d4af37;
            color: #0a0e14;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Chakra Petch', monospace;
            font-size: 1.2em;
            transition: all 0.3s ease;
            position: relative;
            animation: hindsight-pulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 170, 0, 0.5);
        }
        .hindsight-btn:hover {
            background: linear-gradient(145deg, #ffd700 0%, #ffaa00 50%, #ffd700 100%);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 170, 0, 0.8);
        }
        .hindsight-btn:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 170, 0, 0.95);
            color: #0a0e14;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 0.7em;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .hindsight-btn:focus-visible {
            outline: 3px solid #ffaa00;
            outline-offset: 3px;
            box-shadow: 0 0 30px rgba(255, 170, 0, 0.9);
        }
        @keyframes hindsight-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 170, 0, 0.5); }
            50% { box-shadow: 0 0 35px rgba(255, 170, 0, 0.8); }
        }
        
        .title { font-size: 3.15em; color: #39ff14; margin-bottom: 40px; font-weight: bold; letter-spacing: 4px; text-shadow: 0 0 15px #39ff14, 0 0 30px #39ff14, 0 0 45px #39ff14; animation: terminal-flicker 3s ease-in-out infinite; position: relative; }
        @keyframes terminal-flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.95; } }

        /* Santa Emoji for the D */
        .santa-hat {
            position: relative;
            display: inline-block;
        }

        .santa-hat::before {
            content: 'ðŸŽ…';
            position: absolute;
            top: -0.6em;
            right: -0.1em;
            font-size: 0.5em;
            animation: santa-bounce 2s ease-in-out infinite;
        }

        @keyframes santa-bounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-3px) rotate(5deg); }
        }
        
        .btc-ticker {
            background: linear-gradient(145deg, #f7931a 0%, #ffb74d 50%, #f7931a 100%);
            padding: 10px 25px;
            border-radius: 10px;
            margin: 0 auto 25px;
            max-width: 400px;
            border: 3px solid #d97706;
            box-shadow:
                0 8px 25px rgba(0,0,0,0.6),
                inset 0 2px 10px rgba(255,255,255,0.5),
                inset 0 -2px 10px rgba(0,0,0,0.3),
                0 0 30px rgba(247, 147, 26, 0.5);
            transition: all 0.3s ease;
        }

        .btc-ticker:hover {
            transform: translateY(-2px);
            box-shadow:
                0 12px 35px rgba(0,0,0,0.7),
                inset 0 2px 15px rgba(255,255,255,0.6),
                inset 0 -2px 15px rgba(0,0,0,0.4),
                0 0 50px rgba(247, 147, 26, 0.7);
        }

        /* BTC ticker inside slot machine - COMPACT */
        .slot-machine .btc-ticker {
            margin: 0;
            padding: 12px 20px;
            max-width: 100%;
        }
        .btc-label { font-size: 0.65em; color: #0a0e14; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        .btc-price { font-size: 1.4em; font-weight: bold; color: #0a0e14; margin: 2px 0; }
        .btc-change { font-size: 0.8em; font-weight: bold; margin-top: 2px; color: #a0a0a0; }
        .positive { color: #00ff88; }
        .negative { color: #ff3366; }

        /* Left side of slot machine - 50% */
        .slot-left {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        /* Right side of slot machine - 50% */
        .slot-right {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: space-between;
        }

        /* Info card inline styling for cards in slot machine */
        .info-card-inline {
            background: rgba(255, 170, 0, 0.1);
            border: 2px solid rgba(255, 170, 0, 0.3);
            border-radius: 10px;
            padding: 15px 20px;
            text-align: center;
            width: 100%;
        }

        .info-card-inline.btc-card {
            /* Use same dark/gold style as streak card */
            background: rgba(255, 170, 0, 0.1);
            border: 2px solid rgba(255, 170, 0, 0.3);
        }

        .info-card-inline.btc-card .card-label {
            color: #ffaa00;
        }

        .info-card-inline.btc-card .card-value {
            color: #ff8844;  /* Orange like streak number */
            text-shadow: 0 0 15px currentColor;
        }

        .info-card-inline.btc-card .card-change {
            color: #a0a0a0;  /* Gray like "Total value" */
        }

        .info-card-inline .card-label {
            color: #0a0e14;
            font-size: 0.65em;
            font-weight: bold;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .info-card-inline.streak-card .card-label {
            color: #ffaa00;
        }

        .info-card-inline .card-value {
            font-size: 2em;
            font-weight: bold;
            color: #0a0e14;
            margin: 2px 0;
        }

        .info-card-inline.streak-card .card-value {
            color: #ff8844;  /* Orange */
            text-shadow: 0 0 15px currentColor;
        }

        .info-card-inline .card-change {
            color: #0a0e14;
            font-size: 0.8em;
            font-weight: bold;
            margin-top: 2px;
        }

        .info-card-inline .card-desc {
            color: #a0a0a0;
            font-size: 0.7em;
            margin-top: 4px;
        }

        .info-card-inline.streak-card .card-desc {
            color: #a0a0a0;
        }

        .info-card-inline.dominance-card {
            /* Use same dark/gold style as streak card */
            background: rgba(255, 170, 0, 0.1);
            border: 2px solid rgba(255, 170, 0, 0.3);
        }

        .info-card-inline.dominance-card .card-label {
            color: #ffaa00;
            font-weight: 600;
        }

        .info-card-inline.dominance-card .card-value {
            color: #ff8844;  /* Orange like streak number */
            text-shadow: 0 0 15px currentColor;
        }

        .info-card-inline.marketcap-card {
            /* Use same dark/gold style as streak card */
            background: rgba(255, 170, 0, 0.1);
            border: 2px solid rgba(255, 170, 0, 0.3);
        }

        .info-card-inline.marketcap-card .card-label {
            color: #ffaa00;
            font-weight: 600;
        }

        .info-card-inline.marketcap-card .card-value {
            color: #ff8844;  /* Orange like streak number */
            text-shadow: 0 0 15px currentColor;
        }

        .slot-machine {
            width: 100%;
            margin: 35px 0;
            background: linear-gradient(145deg, #151a23 0%, #0a0e14 50%, #151a23 100%);
            border: 6px solid #ffaa00;
            border-radius: 20px;
            padding: 25px 30px 30px;
            /* OPTIMIZED: Reduced from 5 to 2 box-shadows */
            box-shadow:
                0 20px 60px rgba(0,0,0,0.95),
                0 0 60px rgba(255,170,0,0.3);
            position: relative;
            /* GPU acceleration */
            transform: translateZ(0);
            will-change: transform;
            /* Only animate transform */
            transition: transform 0.4s ease;
            display: grid;
            grid-template-columns: 1fr 1fr; /* 50% | 50% split */
            gap: 30px;
            align-items: stretch;
        }

        .slot-machine:hover {
            transform: translateY(-3px) translateZ(0);
            /* No box-shadow changes on hover for better performance */
        }

        .slot-machine:focus-visible {
            outline: 4px solid #ffaa00;
            outline-offset: 4px;
        }

        .slot-machine.spinning {
            cursor: wait;
            animation: machine-shake 0.1s infinite;
        }

        @keyframes machine-shake {
            0%, 100% { transform: translateX(0) translateY(0) translateZ(0); }
            25% { transform: translateX(-2px) translateY(-1px) translateZ(0); }
            50% { transform: translateX(2px) translateY(1px) translateZ(0); }
            75% { transform: translateX(-1px) translateY(1px) translateZ(0); }
        }

        /* Hide mobile info box on desktop */
        .mobile-info-box {
            display: none;
        }

        .mobile-spin-hint {
            display: none;
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffaa00;
            font-size: 0.85em;
            animation: bounce 2s infinite;
            text-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        /* Confetti particle effects */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffaa00;
            animation: confetti-fall 2s ease-out forwards;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(300px) rotate(720deg);
                opacity: 0;
            }
        }

        /* Win flash overlay */
        .win-flash {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,170,0,0.3) 0%, transparent 70%);
            animation: flash-burst 0.5s ease-out;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes flash-burst {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }
        
        .slot-lights {
            display: none;
        }
        .light {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffffff, #ffaa00 40%, #d4af37 100%);
            animation: casino-blink 1.5s infinite;
            box-shadow:
                0 0 5px rgba(255, 170, 0, 0.5),
                0 0 10px rgba(255, 170, 0, 0.4),
                0 0 15px rgba(255, 170, 0, 0.3),
                inset 0 -2px 5px rgba(0, 0, 0, 0.3),
                inset 0 2px 5px rgba(255, 255, 255, 0.4);
            border: 2px solid #8b6508;
            position: relative;
        }
        .light::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 3px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            filter: blur(1px);
        }
        .light:nth-child(2) { animation-delay: 0.3s; }
        .light:nth-child(3) { animation-delay: 0.6s; }
        .light:nth-child(4) { animation-delay: 0.9s; }
        .light:nth-child(5) { animation-delay: 1.2s; }
        @keyframes casino-blink {
            0%, 40%, 100% {
                opacity: 1;
                box-shadow:
                    0 0 10px rgba(255, 170, 0, 0.8),
                    0 0 20px rgba(255, 170, 0, 0.6),
                    0 0 30px rgba(255, 170, 0, 0.4),
                    inset 0 -2px 5px rgba(0, 0, 0, 0.3),
                    inset 0 2px 5px rgba(255, 255, 255, 0.4);
                transform: scale(1);
            }
            20% {
                opacity: 0.3;
                box-shadow:
                    0 0 3px rgba(255, 170, 0, 0.2),
                    inset 0 -2px 5px rgba(0, 0, 0, 0.5),
                    inset 0 2px 5px rgba(255, 255, 255, 0.2);
                transform: scale(0.95);
            }
        }
        
        .reels-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            padding: 25px 20px;
            border-radius: 15px;
            border: 3px solid rgba(255, 170, 0, 0.4);
            box-shadow:
                inset 0 4px 25px rgba(0,0,0,0.9),
                inset 0 -4px 25px rgba(0,0,0,0.7),
                0 4px 20px rgba(0,0,0,0.8);
            position: relative;
        }

        .reels-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 50%, rgba(0,0,0,0.3) 100%);
            border-radius: 10px;
            pointer-events: none;
        }

        .reel {
            width: 120px;
            height: 120px;
            background: linear-gradient(180deg, #151a23 0%, #0a0e14 50%, #151a23 100%);
            border: 4px solid;
            border-image: linear-gradient(180deg, rgba(255, 170, 0, 0.6), rgba(255, 170, 0, 0.3), rgba(255, 170, 0, 0.6)) 1;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            /* OPTIMIZED: Reduced from 4 to 1 box-shadow */
            box-shadow: inset 0 3px 20px rgba(0,0,0,0.95);
            /* GPU acceleration */
            transform: translateZ(0);
            will-change: transform;
        }

        .reel-strip {
            display: flex;
            flex-direction: column;
            position: absolute;
            width: 100%;
            top: 0;
            transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform: translateY(0) translateZ(0);
        }

        .reel.spinning .reel-strip {
            animation: reel-spin 0.5s linear infinite;
        }

        @keyframes reel-spin {
            0% { transform: translateY(0) translateZ(0); }
            100% { transform: translateY(-240px) translateZ(0); }
        }

        .symbol {
            font-size: 4em;
            height: 120px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            /* OPTIMIZED: Reduced from 3 to 1 text-shadow, removed filter */
            text-shadow: 0 0 30px currentColor;
            /* GPU-accelerated properties only */
            transform: translateZ(0) translateY(10px);
            flex-shrink: 0;
        }

        .spin-btn {
            width: 160px;
            height: 50px;
            margin: 0 auto 20px;
            display: block;
            background: linear-gradient(145deg, #ffaa00 0%, #ffd700 50%, #ffaa00 100%);
            border: 4px solid #d4af37;
            border-radius: 25px;
            color: #0a0e14;
            font-family: 'Chakra Petch', monospace;
            font-size: 1.3em;
            font-weight: bold;
            letter-spacing: 3px;
            cursor: pointer;
            box-shadow:
                0 8px 25px rgba(0,0,0,0.6),
                inset 0 2px 10px rgba(255,255,255,0.5),
                inset 0 -2px 10px rgba(0,0,0,0.3),
                0 0 30px rgba(255,170,0,0.5);
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        .spin-btn:hover {
            transform: translateY(-2px) scale(1.05);
            background: linear-gradient(145deg, #ffd700 0%, #ffaa00 50%, #ffd700 100%);
            box-shadow:
                0 12px 35px rgba(0,0,0,0.7),
                inset 0 2px 15px rgba(255,255,255,0.6),
                inset 0 -2px 15px rgba(0,0,0,0.4),
                0 0 50px rgba(255,170,0,0.7);
        }

        .spin-btn:active {
            transform: translateY(0px) scale(1.02);
            box-shadow:
                0 4px 15px rgba(0,0,0,0.5),
                inset 0 2px 8px rgba(255,255,255,0.4),
                inset 0 -2px 8px rgba(0,0,0,0.2),
                0 0 25px rgba(255,170,0,0.4);
        }

        /* Pulsing animation for initial attention - brightness pulse */
        .spin-btn.pulse {
            animation: pulse-brightness 1.5s ease-in-out infinite;
            /* Hardware acceleration for smooth mobile performance */
            will-change: filter, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        /* Disable pulse animation on hover/active */
        .spin-btn.pulse:hover,
        .spin-btn.pulse:active {
            animation: none;
        }

        @keyframes pulse-brightness {
            0%, 100% {
                filter: brightness(1);
                opacity: 0.9;
            }
            50% {
                filter: brightness(1.3);
                opacity: 1;
            }
        }
        
        .payout-display {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            padding: 25px;
            border-radius: 12px;
            border: 3px solid rgba(255, 170, 0, 0.5);
            box-shadow:
                inset 0 3px 20px rgba(0,0,0,0.9),
                inset 0 -3px 20px rgba(0,0,0,0.7),
                0 4px 15px rgba(0,0,0,0.6);
            position: relative;
        }

        .payout-label {
            color: #ffaa00;
            font-size: 0.9em;
            margin-bottom: 5px;
            letter-spacing: 2px;
            text-shadow:
                0 0 5px #ffaa00,
                0 0 10px #ffaa00;
        }

        .payout-score {
            font-size: 3em;
            font-weight: bold;
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor;
            font-family: 'Chakra Petch', monospace;
        }

        .payout-text {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 5px;
            letter-spacing: 2px;
            text-shadow:
                0 0 10px currentColor,
                0 0 20px currentColor;
        }

        /* Streak Card Styles */
        .streak-value {
            font-size: 3em;
            font-weight: bold;
            color: #e6e8eb;
            margin: 10px 0;
            text-shadow: 0 0 15px currentColor;
        }

        .streak-description {
            color: #a0a0a0;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .streak-info {
            font-size: 0.85em;
            color: #a0a0a0;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 170, 0, 0.2);
            font-weight: normal;
            letter-spacing: 0.5px;
        }

        .streak-info.record {
            color: #ffaa00;
            font-weight: bold;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes rain-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(600px) rotate(360deg);
                opacity: 0;
            }
        }

        .emoji-rain {
            position: absolute;
            font-size: 3em;
            top: -50px;
            pointer-events: none;
            z-index: 1000;
            animation: rain-fall 2s ease-in forwards;
            filter: drop-shadow(0 0 10px currentColor);
            will-change: transform, opacity;
        }

        .jackpot {
            animation: jackpot-flash 0.5s infinite, jackpot-pulse 1s ease-in-out infinite;
        }

        @keyframes jackpot-flash {
            0%, 100% {
                transform: scale(1);
                text-shadow:
                    0 0 5px currentColor,
                    0 0 10px currentColor,
                    0 0 15px currentColor;
            }
            50% {
                transform: scale(1.15);
                text-shadow:
                    0 0 10px currentColor,
                    0 0 20px currentColor,
                    0 0 30px currentColor,
                    0 0 40px currentColor;
            }
        }

        @keyframes jackpot-pulse {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.2);
            }
        }
        
        .lever {
            display: none;
        }

        .lever::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 35px;
            background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000 60%, #880000);
            border-radius: 50%;
            box-shadow:
                0 4px 10px rgba(0,0,0,0.5),
                inset -2px -2px 6px rgba(0,0,0,0.5),
                inset 2px 2px 6px rgba(255,100,100,0.6);
        }

        .lever::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 100px;
            background: linear-gradient(90deg, #888, #ccc 50%, #888);
            border-radius: 5px;
            box-shadow:
                2px 0 4px rgba(0,0,0,0.3),
                inset 1px 0 2px rgba(255,255,255,0.5);
        }

        @keyframes lever-idle {
            0%, 100% {
                transform: translateY(-50%) rotate(-5deg);
            }
            50% {
                transform: translateY(-50%) rotate(5deg);
            }
        }

        .lever:hover {
            transform: translateY(-50%) scale(1.2) rotate(0deg);
            filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)) drop-shadow(0 0 30px rgba(255,215,0,0.5));
            animation: none;
        }

        .lever.pulled {
            animation: pull 0.5s ease-out;
        }

        @keyframes pull {
            0% {
                transform: translateY(-50%) rotate(0deg);
            }
            30% {
                transform: translateY(-30%) rotate(25deg) scale(1.1);
            }
            60% {
                transform: translateY(-20%) rotate(15deg);
            }
            100% {
                transform: translateY(-50%) rotate(0deg);
            }
        }
        
        /* Info Cards Grid - Uniform Layout */
        .info-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 35px 0;
            max-width: 1100px;
        }

        .info-card {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            border: 3px solid rgba(255, 170, 0, 0.4);
            border-radius: 15px;
            padding: 35px;
            box-shadow:
                inset 0 3px 20px rgba(0,0,0,0.9),
                0 4px 15px rgba(0,0,0,0.6);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 220px;
        }

        .info-card:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 170, 0, 0.7);
            box-shadow: 0 8px 20px rgba(255, 170, 0, 0.2);
        }

        .info-card-title {
            color: #ffaa00;
            font-size: 0.9em;
            margin-bottom: 15px;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .info-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* Degen Status styling within card */
        .degen {
            font-size: 2.5em;
            font-family: 'Azeret Mono', 'Chalkboard', 'ChalkboardSE-Regular', cursive, sans-serif;
            color: #e6e8eb;
            margin: 0;
            font-weight: bold;
            text-shadow: 0 0 20px currentColor;
            animation: degen-bounce 2s ease-in-out infinite;
        }
        @keyframes degen-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Sentiment Quote styling for card layout */
        .sentiment-quote {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            border: 3px solid;
            border-radius: 15px;
            padding: 35px;
            box-shadow:
                inset 0 3px 20px rgba(0,0,0,0.9),
                0 4px 15px rgba(0,0,0,0.6);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .sentiment-quote::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, currentColor, transparent, currentColor);
            border-radius: 15px;
            z-index: -1;
            opacity: 0.3;
            animation: border-glow 3s ease-in-out infinite;
        }

        @keyframes border-glow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .quote-icon {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .quote-text {
            font-size: 1.2em;
            font-weight: bold;
            line-height: 1.6;
            font-family: 'Chakra Petch', monospace;
            color: #e6e8eb;
            text-shadow: 0 0 10px rgba(230, 232, 235, 0.3);
            font-style: italic;
        }

        .quote-text::before {
            content: '"';
            font-size: 1.5em;
            opacity: 0.5;
            margin-right: 5px;
        }

        .quote-text::after {
            content: '"';
            font-size: 1.5em;
            opacity: 0.5;
            margin-left: 5px;
        }

        /* Action Buttons Container */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .share-btn { background: #0a0e14; border: 2px solid #e6e8eb; color: #e6e8eb; display: inline-flex; align-items: center; gap: 8px; padding: 12px 30px; font-size: 1em; border-radius: 5px; cursor: pointer; font-family: 'Chakra Petch', monospace; font-weight: bold; margin: 0; text-transform: uppercase; letter-spacing: 2px; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(230, 232, 235, 0.2); }
        .share-btn:hover { box-shadow: 0 0 25px rgba(230, 232, 235, 0.6); background: #151a23; transform: scale(1.05); }
        .share-btn:focus-visible { outline: 3px solid #e6e8eb; outline-offset: 3px; box-shadow: 0 0 30px rgba(230, 232, 235, 0.8); }

        .btn { background: linear-gradient(135deg, #39ff14, #00ff88); border: 2px solid #39ff14; color: #0a0e14; padding: 12px 30px; font-size: 1em; border-radius: 5px; cursor: pointer; font-family: 'Chakra Petch', monospace; font-weight: bold; margin: 0; text-transform: uppercase; letter-spacing: 2px; box-shadow: 0 0 15px rgba(57, 255, 20, 0.3); transition: all 0.3s ease; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(57, 255, 20, 0.6); }
        .btn:focus-visible { outline: 3px solid #39ff14; outline-offset: 3px; box-shadow: 0 0 30px rgba(57, 255, 20, 0.8); }

        /* Range Slider Styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 2px solid #ffd700;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 2px solid #ffd700;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        /* Timestamp styling */
        .timestamp-container {
            text-align: center;
            margin-top: 20px;
        }
        
        /* Chart Section - Matching Card Style */
        .chart-container {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            border: 3px solid rgba(255, 170, 0, 0.4);
            border-radius: 15px;
            padding: 40px;
            margin: 35px 0;
            box-shadow:
                inset 0 3px 20px rgba(0,0,0,0.9),
                0 4px 15px rgba(0,0,0,0.6);
            min-height: 350px;
        }

        /* Distribution Chart Specific Styling */
        .distribution-chart-container {
            /* Same width as history chart container */
        }

        .chart-title {
            color: #ffaa00;
            font-size: 1.3em;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 35px;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid rgba(57, 255, 20, 0.2);
        }
        .footer a {
            color: #39ff14;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .footer a:hover {
            color: #39ff14;
            text-shadow: 0 0 10px #39ff14;
        }

        /* DESKTOP OPTIMIZATIONS */
        @media (min-width: 769px) {
            .payout-score {
                font-size: 5rem;
                max-height: 5rem;
            }

            .reel {
                width: 100px;
                height: 100px;
            }

            .symbol {
                font-size: 3.5em;
                height: 100px;
                transform: translateY(8px);
            }

            @keyframes reel-spin {
                0% { transform: translateY(0) translateZ(0); }
                100% { transform: translateY(-200px) translateZ(0); }
            }
        }

        /* MOBILE OPTIMIZATIONS */
        @media (max-width: 768px) {
            body { overflow-x: hidden; }
            .container { padding: 20px 10px 10px; }
            .title { font-size: 2em; letter-spacing: 2px; margin-bottom: 20px; margin-top: 10px; }
            
            /* More visible matrix on mobile */
            #matrix-canvas { opacity: 0.3; }
            
            .btc-ticker { max-width: 90%; padding: 8px 15px; margin-bottom: 20px; }
            .btc-label { font-size: 0.65em; }
            .btc-price { font-size: 1.4em; }
            .btc-change { font-size: 0.85em; }
            
            .slot-machine {
                width: 100%;
                padding: 20px 10px 15px;
                border-width: 4px;
                margin: 20px 0;
                margin-bottom: 20px; /* Reduced from 70px */
                transform: perspective(800px) rotateX(1deg);
                grid-template-columns: 1fr; /* Single column on mobile */
                gap: 20px;
            }

            .slot-machine .btc-ticker {
                max-width: 100%;
            }

            .slot-left {
                gap: 10px; /* Reduce gap on mobile to save space */
            }

            /* MOBILE: Hide slot-right inside slot-machine, show it as separate box below */
            .slot-machine .slot-right {
                display: none;
            }

            /* MOBILE: Create new info cards box below slot machine */
            .mobile-info-box {
                display: block;
                width: 100%;
                padding: 20px 15px;
                background: linear-gradient(145deg, #151a23 0%, #0a0e14 50%, #151a23 100%);
                border: 4px solid #ffd700;
                border-radius: 20px;
                margin: 20px 0 70px;
            }

            .mobile-info-box .info-card-inline {
                margin-bottom: 15px;
            }

            .mobile-info-box .info-card-inline:last-child {
                margin-bottom: 0;
            }

            .info-card-inline.streak-card .card-value {
                font-size: 2em;
            }

            .info-card-inline .card-label {
                font-size: 0.65em;
            }

            .info-card-inline .card-desc {
                font-size: 0.7em;
            }

            .slot-machine:hover {
                transform: perspective(800px) rotateX(0deg) scale(1.01);
            }

            .slot-machine.spinning {
                animation: machine-shake-mobile 0.1s infinite, machine-glow 1s ease-in-out infinite;
            }

            @keyframes machine-shake-mobile {
                0%, 100% { transform: perspective(800px) rotateX(1deg) translateX(0) translateY(0); }
                25% { transform: perspective(800px) rotateX(1deg) translateX(-1px) translateY(-1px); }
                50% { transform: perspective(800px) rotateX(1deg) translateX(1px) translateY(1px); }
                75% { transform: perspective(800px) rotateX(1deg) translateX(-1px) translateY(1px); }
            }
            
            .mobile-spin-hint { display: block; }

            .slot-lights { padding: 0 15px; }
            .light {
                width: 12px;
                height: 12px;
                border-width: 1px;
            }
            .light::after {
                width: 4px;
                height: 4px;
                top: 1px;
                left: 2px;
            }
            
            .reels-container { 
                gap: 8px; 
                padding: 12px; 
                flex-wrap: nowrap;
            }
            .reel { 
                width: 28vw;
                max-width: 90px;
                height: 110px; 
                border-width: 3px;
            }
            .symbol {
                font-size: 2.8em;
                height: 110px;
                transform: translateY(9px);
            }
            
            .payout-display { padding: 12px; margin-top: 15px; }
            .payout-label { font-size: 0.75em; }
            .payout-score { font-size: 2.2em; }
            .payout-text { font-size: 0.9em; letter-spacing: 1px; }
            .streak-info { font-size: 0.7em; margin-top: 8px; padding-top: 8px; }

            .lever { display: none; }
            
            /* Info Cards Grid Mobile */
            .info-cards-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 30px 0;
            }

            .info-card {
                padding: 25px;
                min-height: 180px;
            }

            .degen {
                font-size: 1.8em;
                margin: 0;
                font-family: 'Azeret Mono', 'Marker Felt', 'Chalkboard', cursive, sans-serif;
            }

            .sentiment-quote {
                margin: 0;
                padding: 0;
            }

            .quote-icon {
                font-size: 2em !important;
            }

            .quote-text {
                font-size: 0.9em !important;
                line-height: 1.5;
            }

            .action-buttons {
                gap: 15px;
                margin: 20px 0;
            }

            .share-btn, .btn {
                padding: 12px 20px;
                font-size: 0.9em;
                letter-spacing: 1px;
                margin: 0;
            }
            
            .controls {
                visibility: hidden;
                position: absolute;
                pointer-events: none;
                opacity: 0;
            }

            .controls-mobile {
                display: flex;
                justify-content: space-around;
                align-items: center;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(10, 14, 20, 0.95);
                backdrop-filter: blur(10px);
                padding: 12px 15px;
                border-top: 1px solid rgba(57, 255, 20, 0.2);
                z-index: 999;
                transition: transform 0.3s ease;
            }

            .controls-mobile.hidden-scroll {
                transform: translateY(100%);
            }

            .controls-mobile .control-btn,
            .controls-mobile .hindsight-btn,
            .controls-mobile .telegram-btn {
                flex: 1;
                max-width: 80px;
                min-width: 80px;
                width: 80px;
                padding: 12px !important;
                margin: 0 4px;
                font-size: 1.3em !important;
                display: flex !important;
                align-items: center;
                justify-content: center;
                min-height: 48px;
                max-height: 48px;
                height: 48px;
                border-radius: 5px;
                cursor: pointer;
                box-sizing: border-box;
            }

            /* Override hindsight button styles on mobile */
            .controls-mobile .hindsight-btn {
                background: linear-gradient(145deg, #ffaa00 0%, #ffd700 50%, #ffaa00 100%) !important;
                border: 2px solid #d4af37 !important;
                color: #0a0e14 !important;
                box-shadow: none;
                animation: none;
            }

            /* Override control button styles on mobile */
            .controls-mobile .control-btn {
                background: rgba(26, 122, 10, 0.3) !important;
                border: 1px solid #1a7a0a !important;
                color: #39ff14 !important;
            }

            .controls-mobile .telegram-btn {
                background: rgba(26, 122, 10, 0.3) !important;
                border: 1px solid #1a7a0a !important;
                color: #39ff14 !important;
                text-decoration: none;
            }

            .controls-mobile .telegram-btn:hover {
                background: rgba(57, 255, 20, 0.2) !important;
            }

            .controls-mobile .telegram-btn svg {
                fill: #39ff14;
                width: 20px;
                height: 20px;
            }
            .control-btn { 
                padding: 8px 12px; 
                font-size: 1em; 
            }
            .control-btn:hover::after { display: none; }
            
            .chart-container { 
                padding: 15px 10px; 
                margin: 30px 0;
                min-height: 250px;
            }
            .chart-title { font-size: 1em; margin-bottom: 15px; letter-spacing: 1px; }
            
            #timestamp { font-size: 0.7em; }
        }
        
        @media (max-width: 400px) {
            .title { font-size: 1.6em; }
            .btc-price { font-size: 1.2em; }
            .slot-machine { padding: 15px 8px 10px; }
            .light {
                width: 10px;
                height: 10px;
            }
            .light::after {
                width: 3px;
                height: 3px;
            }
            .reel { width: 26vw; }
            .symbol { font-size: 2.3em; }
            .payout-score { font-size: 1.8em; }
            .degen { font-size: 1.5em; }

            .info-card-inline {
                padding: 10px 15px;
            }

            .info-card-inline.streak-card .card-value {
                font-size: 1.8em;
            }

            .info-card-inline .card-label {
                font-size: 0.6em;
            }

            .slot-machine .btc-ticker {
                padding: 10px 15px;
            }
        }

        /* Hindsight Modal Styles */
        .hindsight-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            animation: fadeIn 0.3s;
            overflow-y: auto;
        }

        .hindsight-modal-content {
            background: linear-gradient(145deg, #151a23 0%, #0a0e14 50%, #151a23 100%);
            margin: 3% auto;
            padding: 0;
            border: 6px solid;
            border-image: linear-gradient(135deg, #ffaa00 0%, #ffd700 50%, #ffaa00 100%) 1;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            box-shadow: 0 20px 60px rgba(0,0,0,0.95), 0 0 60px rgba(255,170,0,0.3);
            animation: slideDown 0.3s;
            display: flex;
            flex-direction: column;
        }

        .hindsight-modal-header {
            padding: 25px 30px;
            background: rgba(255, 170, 0, 0.1);
            border-bottom: 3px solid #ffaa00;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 14px 14px 0 0;
            flex-shrink: 0;
        }

        .hindsight-modal-header h2 {
            color: #ffaa00;
            margin: 0;
            font-size: 1.8em;
            letter-spacing: 2px;
            text-shadow: 0 0 15px #ffaa00;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hindsight-close {
            color: #ff3366;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1;
            text-shadow: 0 0 10px #ff3366;
            padding: 0 5px;
            flex-shrink: 0;
        }

        .hindsight-close:hover {
            color: #ff3366;
            text-shadow: 0 0 20px #ff3366;
            transform: scale(1.3) rotate(90deg);
        }

        .hindsight-modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .hindsight-description {
            color: #aaa;
            margin-bottom: 25px;
            font-size: 0.95em;
            line-height: 1.6;
            text-align: center;
        }

        .current-range-badge {
            background: rgba(255, 170, 0, 0.15);
            border: 2px solid #ffaa00;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1em;
            color: #ffaa00;
            display: inline-block;
            margin: 0 auto 25px;
            text-align: center;
        }

        .time-periods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .period-card {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            border: 3px solid rgba(255, 170, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .period-card:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 170, 0, 0.7);
            box-shadow: 0 8px 20px rgba(255, 170, 0, 0.2);
        }

        .period-label {
            color: #ffaa00;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: bold;
        }

        .period-return {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .period-winrate {
            color: #aaa;
            font-size: 0.9em;
        }

        .historical-stats {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 170, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .hindsight-stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 170, 0, 0.2);
        }

        .hindsight-stat-label {
            color: #aaa;
            font-size: 0.9em;
        }

        .hindsight-stat-value {
            color: #e6e8eb;
            font-weight: bold;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.1), rgba(255, 170, 0, 0.05));
            border-left: 4px solid #ffaa00;
            padding: 15px 20px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .insight-icon {
            font-size: 1.3em;
            margin-right: 10px;
        }

        .insight-text {
            color: #e6e8eb;
            line-height: 1.6;
        }

        .comparison-toggle {
            background: rgba(255, 170, 0, 0.2);
            border: 2px solid #ffaa00;
            color: #ffaa00;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Chakra Petch', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 15px;
            width: 100%;
        }

        .comparison-toggle:hover {
            background: rgba(255, 170, 0, 0.3);
            transform: scale(1.02);
        }

        .comparison-table-container {
            display: none;
            margin-top: 20px;
            overflow-x: auto;
        }

        .comparison-table-container.visible {
            display: block;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 170, 0, 0.2);
        }

        .comparison-table th {
            color: #ffaa00;
            font-weight: bold;
            background: rgba(255, 170, 0, 0.1);
        }

        .comparison-table td {
            color: #e6e8eb;
        }

        .comparison-table tr.current-row {
            background: rgba(57, 255, 20, 0.1);
            border-left: 4px solid #39ff14;
        }

        /* Portfolio Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s;
            overflow-y: auto; /* Allow scrolling */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(145deg, #151a23, #0a0e14);
            margin: 5% auto; /* Increased top margin to prevent cutoff */
            padding: 0;
            border: 4px solid #39ff14;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh; /* Slightly reduced to ensure space from top */
            box-shadow: 0 0 40px rgba(57, 255, 20, 0.4);
            animation: slideDown 0.3s;
            display: flex;
            flex-direction: column;
            position: relative; /* Ensure proper positioning */
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 30px;
            background: rgba(57, 255, 20, 0.1);
            border-bottom: 2px solid #39ff14;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 11px 11px 0 0;
            flex-shrink: 0; /* Prevent header from shrinking */
            min-height: 60px; /* Ensure minimum height */
        }

        .modal-header h2 {
            color: #39ff14;
            margin: 0;
            font-size: 1.5em;
            letter-spacing: 1px; /* Reduced from 2px for better fit */
            text-shadow: 0 0 10px #39ff14;
            flex: 1; /* Allow it to take available space */
            margin-right: 10px; /* Space between title and close button */
        }

        .close {
            color: #ff3366;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1;
            text-shadow: 0 0 10px #ff3366;
            padding: 0 5px;
            flex-shrink: 0; /* Prevent close button from shrinking */
        }

        .close:hover {
            color: #ff3366;
            text-shadow: 0 0 20px #ff3366;
            transform: scale(1.3) rotate(90deg);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto; /* Allow scrolling in body */
            flex: 1;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #39ff14;
            font-size: 1em;
            margin-bottom: 8px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            background: #0a0e14;
            border: 2px solid #39ff14;
            border-radius: 5px;
            color: #39ff14;
            font-size: 1.1em;
            font-family: 'Chakra Petch', monospace;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #39ff14;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
        }

        .input-group input::placeholder {
            color: rgba(57, 255, 20, 0.4);
        }

        .allocation-stats {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(57, 255, 20, 0.3);
            border-radius: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(57, 255, 20, 0.2);
            font-size: 1em;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #39ff14;
            font-weight: bold;
        }

        .stat-value {
            color: #e6e8eb;
            font-weight: bold;
        }

        /* Portfolio Advice Styles - Card Layout */
        .portfolio-advice {
            background: linear-gradient(145deg, #0a0e14 0%, #151a23 100%);
            border: 3px solid rgba(255, 170, 0, 0.4);
            border-radius: 15px;
            padding: 35px;
            box-shadow:
                inset 0 3px 20px rgba(0,0,0,0.9),
                0 4px 15px rgba(0,0,0,0.6);
            transition: all 0.3s ease;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .advice-title {
            color: #ffaa00;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .advice-text {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            text-shadow: 0 0 15px currentColor;
            animation: advice-pulse 2s ease-in-out infinite;
        }

        @keyframes advice-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Mobile Adjustments for Portfolio */
        @media (max-width: 768px) {
            .modal-content {
                margin: 2% auto;
                width: 95%;
                max-height: 95vh; /* More height on mobile */
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-header h2 {
                font-size: 1.2em;
            }

            .modal-body {
                padding: 20px;
                max-height: calc(95vh - 80px); /* Account for header */
            }

            .input-group input {
                padding: 10px 12px;
                font-size: 1em;
            }

            .input-group {
                margin-bottom: 15px; /* Reduce spacing on mobile */
            }

            .portfolio-advice {
                margin: 15px;
                padding: 15px 20px;
            }

            .advice-title {
                font-size: 1.1em;
            }

            .advice-text {
                font-size: 1.2em;
            }

            .close {
                font-size: 2em;
            }

            /* Backtester Modal Mobile Optimizations */
            .backtester-modal-content {
                max-width: 100% !important;
                margin: 0 !important;
                width: 100% !important;
                height: 100vh !important;
                max-height: 100vh !important;
                border-radius: 0 !important;
            }

            #backtesterContent {
                padding: 15px !important;
            }

            #backtesterContent .badge {
                font-size: 0.8em !important;
                padding: 10px 15px !important;
                margin: 15px 0 !important;
            }

            #backtesterContent .slider-section {
                padding: 20px 15px !important;
                margin: 20px 0 !important;
            }

            #backtesterContent .slider-value {
                font-size: 2em !important;
                margin: 15px 0 !important;
            }

            #backtesterContent .strategy-card {
                padding: 20px 15px !important;
                margin: 20px 0 !important;
            }

            #backtesterContent .strategy-title {
                font-size: 1.2em !important;
            }

            #backtesterContent .strategy-desc {
                font-size: 0.85em !important;
                margin-bottom: 15px !important;
            }

            #backtesterContent .day-selector {
                gap: 6px !important;
            }

            #backtesterContent .day-btn {
                padding: 8px 12px !important;
                font-size: 0.85em !important;
                min-width: auto !important;
            }

            #backtesterContent .comparison-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            #backtesterContent .comparison-col {
                padding: 15px !important;
            }

            #backtesterContent .comparison-title {
                font-size: 1em !important;
                margin-bottom: 12px !important;
            }

            #backtesterContent .stat-label {
                font-size: 0.85em !important;
            }

            #backtesterContent .stat-value {
                font-size: 0.95em !important;
            }

            #backtesterContent .profit-box {
                padding: 15px !important;
                margin: 15px 0 !important;
            }

            #backtesterContent .profit-box .amount {
                font-size: 1.8em !important;
            }

            #backtesterContent .profit-box .label {
                font-size: 0.85em !important;
            }

            #backtesterContent .note {
                font-size: 0.8em !important;
                padding: 12px 15px !important;
                margin: 15px 0 !important;
            }
        }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>

    <div class="controls" id="controls">
        <button class="hindsight-btn" id="hindsightToggle" data-tooltip="Hindsight Tool" aria-label="View historical analysis and predictions" aria-pressed="false">ðŸ”®</button>
        <a href="https://t.me/fgichadbot" target="_blank" rel="noopener noreferrer" class="control-btn telegram-btn" data-tooltip="Telegram Alerts" aria-label="Subscribe to Telegram alerts for extreme FGI levels">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle;">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635.099-.002.321.023.465.14.121.098.155.23.171.324.016.094.036.308.02.475z"/>
            </svg>
        </a>
        <button class="control-btn" id="backtesterToggle" data-tooltip="Strategy Backtester" aria-label="Backtest investment strategies" aria-pressed="false">â™Ÿï¸</button>
        <button class="control-btn" id="portfolioToggle" data-tooltip="My Portfolio" aria-label="View and manage your portfolio" aria-pressed="false">ðŸ’¼</button>
    </div>

    <div class="container">
        <h1 class="title">&gt; FGI_CHA<span class="santa-hat">D</span> &lt;</h1>

        <div id="content">
            <div class="slot-machine" id="slotMachine">
                <!-- LEFT HALF (50%) -->
                <div class="slot-left">
                    <div class="reels-container">
                        <div class="reel" id="reel1">
                            <div class="reel-strip">
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ¤‘">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                            </div>
                        </div>
                        <div class="reel" id="reel2">
                            <div class="reel-strip">
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ¤‘">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                            </div>
                        </div>
                        <div class="reel" id="reel3">
                            <div class="reel-strip">
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ¤‘">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ’€">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜±">ðŸ€</div>
                                <div class="symbol" data-actual="ðŸ˜">ðŸ€</div>
                            </div>
                        </div>
                    </div>
                    <button class="spin-btn" id="spinBtn" role="button" aria-label="Spin the slot machine to reveal current market sentiment">
                        <span class="spin-text">SPIN</span>
                    </button>
                    <div class="payout-display">
                        <div class="payout-label">MARKET SENTIMENT</div>
                        <div class="payout-score" id="slotScore">--</div>
                        <div class="payout-text" id="slotStatus">...</div>
                        <div class="streak-info" id="streakInfo"></div>
                    </div>
                </div>

                <!-- RIGHT HALF (50%) -->
                <div class="slot-right">
                    <!-- BTC Price Card (top) -->
                    <div class="info-card-inline btc-card">
                        <div class="card-label">â‚¿ BITCOIN</div>
                        <div class="card-value" id="btcPrice">Loading...</div>
                        <div class="card-change" id="btcChange"></div>
                    </div>

                    <!-- BTC Dominance Card (NEW) -->
                    <div class="info-card-inline dominance-card">
                        <div class="card-label">BTC DOMINANCE</div>
                        <div class="card-value" id="btcDominance">--%</div>
                        <div class="card-desc">Market share</div>
                    </div>

                    <!-- BTC Market Cap Card (NEW) -->
                    <div class="info-card-inline marketcap-card">
                        <div class="card-label">BTC MARKET CAP</div>
                        <div class="card-value" id="btcMarketCap">$--</div>
                        <div class="card-desc">Total value</div>
                    </div>

                    <!-- Sentiment Streak Card (bottom) -->
                    <div class="info-card-inline streak-card">
                        <div class="card-label" id="streakLabelInline">SENTIMENT STREAK</div>
                        <div class="card-value" id="streakValueInline">0</div>
                        <div class="card-desc" id="streakDescInline">Current sentiment streak</div>
                    </div>
                </div>
            </div>

            <!-- Mobile Info Box (visible only on mobile) -->
            <div class="mobile-info-box">
                <!-- BTC Price Card -->
                <div class="info-card-inline btc-card">
                    <div class="card-label">â‚¿ BITCOIN</div>
                    <div class="card-value" id="btcPriceMobile">Loading...</div>
                    <div class="card-change" id="btcChangeMobile"></div>
                </div>

                <!-- BTC Dominance Card -->
                <div class="info-card-inline dominance-card">
                    <div class="card-label">BTC DOMINANCE</div>
                    <div class="card-value" id="btcDominanceMobile">--%</div>
                    <div class="card-desc">Market share</div>
                </div>

                <!-- BTC Market Cap Card -->
                <div class="info-card-inline marketcap-card">
                    <div class="card-label">BTC MARKET CAP</div>
                    <div class="card-value" id="btcMarketCapMobile">$--</div>
                    <div class="card-desc">Total value</div>
                </div>

                <!-- Sentiment Streak Card -->
                <div class="info-card-inline streak-card">
                    <div class="card-label" id="streakLabelInlineMobile">SENTIMENT STREAK</div>
                    <div class="card-value" id="streakValueInlineMobile">0</div>
                    <div class="card-desc" id="streakDescInlineMobile">Current sentiment streak</div>
                </div>
            </div>

            <!-- Info Cards Grid -->
            <div class="info-cards-grid">
                <!-- Degen Status Card -->
                <div class="info-card">
                    <div class="info-card-title">Degen Status</div>
                    <div class="info-card-content">
                        <div class="degen" id="degenStatus">...</div>
                    </div>
                </div>

                <!-- Sentiment Quote Card -->
                <div class="info-card">
                    <div class="info-card-title">Market Wisdom</div>
                    <div class="info-card-content">
                        <div class="sentiment-quote" id="sentimentQuote" style="border: none; box-shadow: none; padding: 0; min-height: auto; background: transparent;">
                            <span class="quote-icon" id="quoteIcon" style="font-size: 2.5em;">ðŸ’Ž</span>
                            <div class="quote-text" id="quoteText" style="font-size: 1em; margin-top: 10px;">Loading wisdom...</div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Advice Card -->
                <div class="info-card" id="portfolioAdviceCard" style="display:none;">
                    <div class="info-card-title">Portfolio Recommendation</div>
                    <div class="info-card-content">
                        <div class="portfolio-advice" id="portfolioAdvice" style="border: none; box-shadow: none; padding: 0; min-height: auto; background: transparent; display: block;">
                            <div class="advice-text" id="adviceText">...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="share-btn" id="shareBtn" aria-label="Share current market sentiment on X (formerly Twitter)">Share on <span style="font-size:1.3em">ð•</span></button>
                <button class="btn" id="refreshBtn" aria-label="Refresh all market data and sentiment">[  REFRESH  ]</button>
            </div>

            <!-- Timestamp -->
            <div class="timestamp-container">
                <div style="color:#00ff00;font-size:0.8em;opacity:0.6;" id="timestamp">> Last Updated: --:--:--</div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-title" id="chartTitle">30-Day Sentiment History</div>
            <canvas id="historyChart"></canvas>
        </div>

        <!-- Sentiment Distribution Chart (NEW) -->
        <div class="chart-container distribution-chart-container">
            <div class="chart-title">Sentiment Distribution (30 Days)</div>
            <canvas id="distributionChart" style="max-height: 350px;"></canvas>
        </div>

        <div class="footer">
            Made by <a href="https://x.com/firedintern" target="_blank" rel="noopener noreferrer">firedintern</a>
        </div>
    </div>

    <!-- Hindsight Score Modal -->
    <div id="hindsightModal" class="hindsight-modal" role="dialog" aria-labelledby="hindsightTitle" aria-hidden="true">
        <div class="hindsight-modal-content" role="document">
            <div class="hindsight-modal-header">
                <h2 id="hindsightTitle">ðŸ”® Hindsight Score</h2>
                <span class="hindsight-close" role="button" aria-label="Close hindsight modal" tabindex="0">&times;</span>
            </div>
            <div class="hindsight-modal-body">
                <div class="hindsight-description">
                    Historical analysis of BTC price performance based on 5.5 years of Fear & Greed Index data (2,000 days)
                </div>

                <div style="text-align: center;">
                    <div class="current-range-badge" id="currentRangeBadge">Loading...</div>
                </div>

                <div class="time-periods">
                    <div class="period-card">
                        <div class="period-label">7 Days Forward</div>
                        <div class="period-return" id="return7d">--</div>
                        <div class="period-winrate" id="winrate7d">Win Rate: --%</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">14 Days Forward</div>
                        <div class="period-return" id="return14d">--</div>
                        <div class="period-winrate" id="winrate14d">Win Rate: --%</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">30 Days Forward</div>
                        <div class="period-return" id="return30d">--</div>
                        <div class="period-winrate" id="winrate30d">Win Rate: --%</div>
                    </div>
                </div>

                <div class="historical-stats">
                    <div class="stats-grid">
                        <div class="hindsight-stat-item">
                            <span class="hindsight-stat-label">Best Case (30d):</span>
                            <span class="hindsight-stat-value" id="bestCase">--</span>
                        </div>
                        <div class="hindsight-stat-item">
                            <span class="hindsight-stat-label">Worst Case (30d):</span>
                            <span class="hindsight-stat-value" id="worstCase">--</span>
                        </div>
                        <div class="hindsight-stat-item">
                            <span class="hindsight-stat-label">Sample Size:</span>
                            <span class="hindsight-stat-value" id="sampleSize">--</span>
                        </div>
                    </div>
                </div>

                <div class="insight-box">
                    <span class="insight-icon">ðŸ’¡</span>
                    <span class="insight-text" id="insightText">Loading insights...</span>
                </div>

                <button class="comparison-toggle" id="comparisonToggle">ðŸ“Š Compare All FGI Ranges</button>

                <div class="comparison-table-container" id="comparisonTableContainer">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>FGI Range</th>
                                <th>7d Return</th>
                                <th>14d Return</th>
                                <th>30d Return</th>
                                <th>Win Rate</th>
                                <th>Sample Size</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Modal -->
    <div id="portfolioModal" class="modal" role="dialog" aria-labelledby="portfolioTitle" aria-hidden="true">
        <div class="modal-content" role="document">
            <div class="modal-header">
                <h2 id="portfolioTitle">My Portfolio</h2>
                <span class="close" role="button" aria-label="Close portfolio modal" tabindex="0">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="cryptoInput">Crypto Holdings ($)</label>
                    <input type="number" id="cryptoInput" placeholder="5000" min="0" step="100">
                </div>
                <div class="input-group">
                    <label for="stablesInput">Stablecoins ($)</label>
                    <input type="number" id="stablesInput" placeholder="5000" min="0" step="100">
                </div>
                <button class="btn" id="savePortfolioBtn">Save Portfolio</button>

                <div id="portfolioChart" style="display:none;">
                    <div class="chart-title" style="margin-top:30px;font-size:1.1em;">Allocation Breakdown</div>
                    <canvas id="allocationChart" style="max-height:250px;"></canvas>
                    <div id="allocationStats" class="allocation-stats"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Backtester Modal -->
    <div id="backtesterModal" class="modal" role="dialog" aria-labelledby="backtesterTitle" aria-hidden="true">
        <div class="modal-content backtester-modal-content" role="document" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 id="backtesterTitle">Strategy Backtester</h2>
                <span class="close" role="button" aria-label="Close backtester modal" tabindex="0">&times;</span>
            </div>
            <div class="modal-body" id="backtesterContent">
                <div class="badge" style="background: rgba(0, 200, 100, 0.15); border: 1px solid #00c864; color: #00ff88; padding: 12px 20px; margin: 20px 0; border-radius: 8px; text-align: center; font-size: 0.95em;">
                    Based on 8 years of historical data | 97 Extreme Fear streaks analyzed
                </div>

                <div class="slider-section" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 30px; margin: 30px 0;">
                    <label class="slider-label" style="color: #c0c0c0; font-size: 1em; margin-bottom: 15px; display: block;">Investment Amount</label>
                    <div class="slider-value" style="color: #ffd700; font-size: 2.5em; font-weight: bold; text-align: center; margin: 20px 0;">$<span id="investmentValue">1,000</span></div>
                    <input type="range" id="investmentSlider" min="100" max="10000" step="100" value="1000" style="width: 100%; height: 6px; border-radius: 3px; background: rgba(255, 255, 255, 0.1); outline: none; -webkit-appearance: none;">
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666; font-size: 0.85em;">
                        <span>$100</span>
                        <span>$10,000</span>
                    </div>
                </div>

                <div class="strategy-card" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 30px; margin: 25px 0;">
                    <div class="strategy-title" style="color: #ffd700; font-size: 1.4em; margin-bottom: 10px; font-weight: 600;">Buy During Extreme Fear, Sell at Greed</div>
                    <div class="strategy-desc" style="color: #a0a0a0; font-size: 0.95em; margin-bottom: 25px; line-height: 1.5;">
                        Compare returns based on which day of an Extreme Fear streak you enter.
                        Exit when FGI reaches Greed (â‰¥60) vs Extreme Greed (â‰¥80).
                    </div>

                    <div class="slider-section" style="background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 25px 30px; margin: 25px 0;">
                        <label class="slider-label" style="color: #c0c0c0; font-size: 1em; margin-bottom: 15px; display: block;">Entry Day in Extreme Fear Streak</label>
                        <div class="slider-value" style="color: #ffd700; font-size: 2.5em; font-weight: bold; text-align: center; margin: 20px 0;">Day <span id="dayValue">1</span></div>
                        <input type="range" id="daySlider" min="1" max="20" step="1" value="1" style="width: 100%; height: 6px; border-radius: 3px; background: rgba(255, 255, 255, 0.1); outline: none; -webkit-appearance: none;">
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666; font-size: 0.85em;">
                            <span>Day 1</span>
                            <span>Day 20</span>
                        </div>
                    </div>

                    <div class="comparison-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0;">
                        <div class="comparison-col" style="background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px;">
                            <div class="comparison-title" style="color: #00c864; font-size: 1.1em; margin-bottom: 15px; font-weight: 600;">Sell at Greed (FGI â‰¥ 60)</div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Sample Size</span>
                                <span class="stat-value" id="greed-samples" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Avg Return</span>
                                <span class="stat-value positive" id="greed-roi" style="color: #00ff88; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Win Rate</span>
                                <span class="stat-value" id="greed-winrate" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Avg Hold Time</span>
                                <span class="stat-value" id="greed-days" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="profit-box" style="background: linear-gradient(135deg, rgba(0, 200, 100, 0.15), rgba(0, 150, 100, 0.1)); border: 1px solid #00c864; border-radius: 10px; padding: 25px; margin-top: 20px; text-align: center;">
                                <div class="label" style="color: #a0a0a0; font-size: 0.95em;">Your investment becomes</div>
                                <div class="amount" id="greed-profit" style="color: #00ff88; font-size: 2.5em; font-weight: bold; margin: 10px 0;">-</div>
                            </div>
                        </div>

                        <div class="comparison-col" style="background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px;">
                            <div class="comparison-title" style="color: #00c864; font-size: 1.1em; margin-bottom: 15px; font-weight: 600;">Sell at Extreme Greed (FGI â‰¥ 80)</div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Sample Size</span>
                                <span class="stat-value" id="xgreed-samples" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Avg Return</span>
                                <span class="stat-value positive" id="xgreed-roi" style="color: #00ff88; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Win Rate</span>
                                <span class="stat-value" id="xgreed-winrate" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="stat-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                                <span class="stat-label" style="color: #909090; font-size: 0.9em;">Avg Hold Time</span>
                                <span class="stat-value" id="xgreed-days" style="color: #e0e0e0; font-weight: 600;">-</span>
                            </div>
                            <div class="profit-box" style="background: linear-gradient(135deg, rgba(0, 200, 100, 0.15), rgba(0, 150, 100, 0.1)); border: 1px solid #00c864; border-radius: 10px; padding: 25px; margin-top: 20px; text-align: center;">
                                <div class="label" style="color: #a0a0a0; font-size: 0.95em;">Your investment becomes</div>
                                <div class="amount" id="xgreed-profit" style="color: #00ff88; font-size: 2.5em; font-weight: bold; margin: 10px 0;">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="note" style="background: rgba(255, 200, 0, 0.1); border-left: 3px solid #ffc800; padding: 15px 20px; margin: 20px 0; border-radius: 5px; color: #e0e0e0; font-size: 0.9em;">
                        Data shows later entry days (15-20) historically had better returns but fewer occurrences.
                        Extreme Greed exits required much longer hold times (~1 year+) but never lost money historically.
                    </div>
                </div>

                <div class="strategy-card" style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 30px; margin: 25px 0;">
                    <div class="strategy-title" style="color: #ffd700; font-size: 1.4em; margin-bottom: 10px; font-weight: 600;">Day 1 Entry + 90-Day Hold</div>
                    <div class="strategy-desc" style="color: #a0a0a0; font-size: 0.95em; margin-bottom: 25px; line-height: 1.5;">
                        Buy on the first day of Extreme Fear and hold for exactly 90 days regardless of FGI.
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div class="stat-row" style="flex-direction: column; align-items: flex-start; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding: 10px 0;">
                            <span class="stat-label" style="color: #909090; font-size: 0.9em;">Sample Size</span>
                            <span class="stat-value" style="color: #e0e0e0; font-weight: 600;">92 trades</span>
                        </div>
                        <div class="stat-row" style="flex-direction: column; align-items: flex-start; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding: 10px 0;">
                            <span class="stat-label" style="color: #909090; font-size: 0.9em;">Avg Return</span>
                            <span class="stat-value negative" style="color: #ff6b6b; font-weight: 600;">-1.13%</span>
                        </div>
                        <div class="stat-row" style="flex-direction: column; align-items: flex-start; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding: 10px 0;">
                            <span class="stat-label" style="color: #909090; font-size: 0.9em;">Win Rate</span>
                            <span class="stat-value" style="color: #e0e0e0; font-weight: 600;">42.4%</span>
                        </div>
                        <div class="stat-row" style="flex-direction: column; align-items: flex-start; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding: 10px 0;">
                            <span class="stat-label" style="color: #909090; font-size: 0.9em;">Best Case</span>
                            <span class="stat-value positive" style="color: #00ff88; font-weight: 600;">+79.05%</span>
                        </div>
                        <div class="stat-row" style="flex-direction: column; align-items: flex-start; border-bottom: 1px solid rgba(255, 255, 255, 0.05); padding: 10px 0;">
                            <span class="stat-label" style="color: #909090; font-size: 0.9em;">Worst Case</span>
                            <span class="stat-value negative" style="color: #ff6b6b; font-weight: 600;">-50.23%</span>
                        </div>
                    </div>

                    <div class="profit-box" style="background: linear-gradient(135deg, rgba(0, 200, 100, 0.15), rgba(0, 150, 100, 0.1)); border: 1px solid #00c864; border-radius: 10px; padding: 25px; margin: 20px 0; text-align: center;">
                        <div class="label" style="color: #a0a0a0; font-size: 0.95em;">Your <span id="hodl-invest">$1,000</span> would become</div>
                        <div class="amount negative" id="hodl-profit" style="color: #ff6b6b; font-size: 2.5em; font-weight: bold; margin: 10px 0;">$989</div>
                        <div class="label" style="font-size: 0.9em; margin-top: 5px; color: #a0a0a0;">Average outcome after 90 days</div>
                    </div>

                    <div class="note" style="background: rgba(255, 200, 0, 0.1); border-left: 3px solid #ffc800; padding: 15px 20px; margin: 20px 0; border-radius: 5px; color: #e0e0e0; font-size: 0.9em;">
                        Historical data shows 90-day holds from Extreme Fear Day 1 underperformed.
                        Waiting for sentiment signals (Greed/Extreme Greed) was more profitable.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentScore=0,particlesEnabled=true,notificationsEnabled=false,lastNotificationScore=null,isSpinning=false;
        let audioContext;
        
        function initAudio(){
            if(!audioContext){
                audioContext=new(window.AudioContext||window.webkitAudioContext)();
            }
        }
        
        function playJackpotSound(){
            initAudio();
            const now=audioContext.currentTime;
            const notes=[523.25,659.25,783.99,1046.50];
            notes.forEach((freq,i)=>{
                const osc=audioContext.createOscillator();
                const gain=audioContext.createGain();
                osc.type='sine';
                osc.frequency.setValueAtTime(freq,now+(i*0.15));
                gain.gain.setValueAtTime(0,now+(i*0.15));
                gain.gain.linearRampToValueAtTime(0.3,now+(i*0.15)+0.01);
                gain.gain.exponentialRampToValueAtTime(0.01,now+(i*0.15)+0.4);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(now+(i*0.15));
                osc.stop(now+(i*0.15)+0.5);
            });
            setTimeout(()=>{
                [523.25,659.25,783.99].forEach(freq=>{
                    const osc=audioContext.createOscillator();
                    const gain=audioContext.createGain();
                    const time=audioContext.currentTime;
                    osc.type='sine';
                    osc.frequency.setValueAtTime(freq,time);
                    gain.gain.setValueAtTime(0.2,time);
                    gain.gain.exponentialRampToValueAtTime(0.01,time+0.8);
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.start(time);
                    osc.stop(time+0.8);
                });
            },600);
        }
        
        const canvas=document.getElementById('matrix-canvas'),ctx=canvas.getContext('2d');
        canvas.width=document.documentElement.clientWidth||window.innerWidth;
        canvas.height=document.documentElement.clientHeight||window.innerHeight;
        const matrix="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%â‚¿ðŸ§®ðŸ“ŠðŸŽ°ðŸ’€ðŸ˜±ðŸ˜°ðŸ˜ðŸ˜ðŸ¤‘";
        const fontSize=14,columns=canvas.width/fontSize;
        const drops=[];
        for(let i=0;i<columns;i++)drops[i]=1;

        let matrixAnimationId = null;
        let lastMatrixFrame = 0;

        function drawMatrix(timestamp){
            if(!particlesEnabled){
                matrixAnimationId = requestAnimationFrame(drawMatrix);
                return;
            }

            // Throttle to 20 FPS (50ms) instead of 28 FPS for better performance
            if(timestamp - lastMatrixFrame < 50){
                matrixAnimationId = requestAnimationFrame(drawMatrix);
                return;
            }
            lastMatrixFrame = timestamp;

            ctx.fillStyle='rgba(0,0,0,0.05)';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle='#0F0';
            ctx.font=fontSize+'px monospace';
            for(let i=0;i<drops.length;i++){
                const text=matrix[Math.floor(Math.random()*matrix.length)];
                ctx.fillText(text,i*fontSize,drops[i]*fontSize);
                if(drops[i]*fontSize>canvas.height&&Math.random()>0.975)drops[i]=0;
                drops[i]++;
            }

            matrixAnimationId = requestAnimationFrame(drawMatrix);
        }

        matrixAnimationId = requestAnimationFrame(drawMatrix);
        window.addEventListener('resize',()=>{
            canvas.width=document.documentElement.clientWidth||window.innerWidth;
            canvas.height=document.documentElement.clientHeight||window.innerHeight;
        });
        
        function getColorForScore(s){
            if(s<20)return '#ff4444';
            if(s<40)return '#ff8844';
            if(s<60)return '#ffd700';
            if(s<80)return '#88ff44';
            return '#44ff88';
        }
        
        function getSymbolForScore(s){
            if(s<=25)return 'ðŸ’€';  // Extreme Fear: 0-25 (matches API classification)
            if(s<=45)return 'ðŸ˜±';  // Fear: 26-45
            if(s<=54)return 'ðŸ˜';  // Neutral: 46-54
            if(s<=74)return 'ðŸ˜';  // Greed: 55-74
            return 'ðŸ¤‘';           // Extreme Greed: 75-100
        }

        function getQuoteForScore(s){
            if(s<=25){  // Extreme Fear: 0-25
                return {
                    icon: 'ðŸ’Ž',
                    text: 'Be greedy when others are fearful. Blood in the streets means diamonds in the wallet.'
                };
            }
            if(s<=45){  // Fear: 26-45
                return {
                    icon: 'ðŸ¤”',
                    text: 'The best buys happen when everyone\'s too scared to click. Your future self will thank you.'
                };
            }
            if(s<=54){  // Neutral: 46-54
                return {
                    icon: 'ðŸ˜',
                    text: 'Boring markets build wealth. Patience pays more than FOMO ever will.'
                };
            }
            if(s<=74){  // Greed: 55-74
                return {
                    icon: 'ðŸš¨',
                    text: 'When your barber\'s giving crypto tips, it\'s time to secure the bag. Bulls make money, bears make money, pigs get slaughtered.'
                };
            }
            return {  // Extreme Greed: 75-100
                icon: 'âš ï¸',
                text: 'Euphoria is expensive. Everyone\'s a genius in a bull market until the music stops. Cash out before the rug pull.'
            };
        }

        function updateSentimentQuote(score, color){
            const quote = getQuoteForScore(score);
            document.getElementById('quoteIcon').textContent = quote.icon;
            document.getElementById('quoteText').textContent = quote.text;
            document.getElementById('sentimentQuote').style.borderColor = color;
            document.getElementById('sentimentQuote').style.color = color;
        }

        function triggerWinEffect(color){
            // Flash effect disabled per user request
            // Users should see the result without the distracting flash animation
            return;
        }

        function spinSlots(){
            if(isSpinning){
                console.log('Already spinning, ignoring click');
                return;
            }
            isSpinning=true;
            console.log('Spin started, isSpinning =', isSpinning);

            playJackpotSound();
            refreshAll();
        }

        function updateSlotMachine(score){
            const symbol=getSymbolForScore(score);
            const color=getColorForScore(score);

            // Map symbol to index position (0-4)
            const symbolMap = {'ðŸ’€':0, 'ðŸ˜±':1, 'ðŸ˜':2, 'ðŸ˜':3, 'ðŸ¤‘':4};
            const targetIndex = symbolMap[symbol] || 0;
            const targetPosition = -targetIndex * 120; // Each symbol is 120px tall

            const reels = document.querySelectorAll('.reel');
            const machine = document.getElementById('slotMachine');

            // First, reset all reels to show clovers at position 0
            reels.forEach(reel => {
                const strip = reel.querySelector('.reel-strip');
                strip.style.transform = 'translateY(0) translateZ(0)';
            });

            // Reset symbols to clovers before spinning
            document.querySelectorAll('.symbol[data-actual]').forEach(symbolEl => {
                symbolEl.textContent = 'ðŸ€';
            });

            // Small delay to ensure visual reset, then replace with actual emojis
            setTimeout(() => {
                document.querySelectorAll('.symbol[data-actual]').forEach(symbolEl => {
                    symbolEl.textContent = symbolEl.getAttribute('data-actual');
                });
            }, 50);

            // Add spinning class for CSS animation
            machine.classList.add('spinning');
            reels.forEach(reel => reel.classList.add('spinning'));

            // Stop reels with stagger
            reels.forEach((reel, index) => {
                setTimeout(() => {
                    // Remove spinning animation
                    reel.classList.remove('spinning');

                    // Position reel to show target symbol
                    const strip = reel.querySelector('.reel-strip');
                    strip.style.transform = `translateY(${targetPosition}px) translateZ(0)`;

                    // Last reel complete
                    if (index === 2) {
                        machine.classList.remove('spinning');

                        setTimeout(() => {
                            document.getElementById('slotScore').textContent = score;
                            document.getElementById('slotScore').style.color = color;
                            const extreme = score <= 20 || score >= 80;
                            if (extreme) {
                                document.getElementById('slotScore').classList.add('jackpot');
                                triggerWinEffect(color);
                            } else {
                                document.getElementById('slotScore').classList.remove('jackpot');
                            }

                            // Trigger raining emoji effect
                            triggerEmojiRain(symbol);

                            // Reset AFTER everything completes
                            isSpinning = false;
                            console.log('Spin complete, isSpinning =', isSpinning);
                        }, 200);
                    }
                }, 660 + (index * 330));
            });
        }

        // Raining emoji jackpot effect - OPTIMIZED
        function triggerEmojiRain(emoji) {
            const container = document.getElementById('slotMachine');
            const numEmojis = 20;
            const fragment = document.createDocumentFragment();
            const emojis = [];

            // Create all elements in memory first (no DOM reflows)
            for (let i = 0; i < numEmojis; i++) {
                const emojiEl = document.createElement('div');
                emojiEl.textContent = emoji;
                emojiEl.className = 'emoji-rain';
                emojiEl.style.left = Math.random() * 100 + '%';
                emojiEl.style.animationDelay = (i * 0.1) + 's';
                emojis.push(emojiEl);
                fragment.appendChild(emojiEl);
            }

            // Single DOM append (only 1 reflow instead of 20)
            requestAnimationFrame(() => {
                container.appendChild(fragment);

                // Single cleanup timer instead of 20
                setTimeout(() => {
                    emojis.forEach(el => el.remove());
                }, 2100);
            });
        }

        // Telegram alerts - handled via external link to t.me/fgichadbot

        // Simple cache to reduce API calls and avoid rate limiting
        const apiCache = {
            btcPrice: { data: null, timestamp: 0 },
            globalData: { data: null, timestamp: 0 } // Cache for dominance + market cap (same API)
        };
        const CACHE_DURATION = 60000; // 60 seconds

        function isCacheValid(cacheKey) {
            const cache = apiCache[cacheKey];
            return cache.data && (Date.now() - cache.timestamp) < CACHE_DURATION;
        }

        // Fetch global data (dominance + market cap) once and cache it
        async function fetchGlobalData() {
            if (isCacheValid('globalData')) {
                return apiCache.globalData.data;
            }

            try {
                const response = await fetch('https://api.coingecko.com/api/v3/global', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();

                // Cache the result
                apiCache.globalData = { data: data.data, timestamp: Date.now() };
                return data.data;
            } catch (error) {
                console.error('Error fetching global data:', error);
                return null;
            }
        }

        async function fetchBTCPrice(){
            // Check cache first
            if (isCacheValid('btcPrice')) {
                const cached = apiCache.btcPrice.data;
                const priceText = '$'+cached.price.toLocaleString('en-US',{maximumFractionDigits:0});
                const changeText = (cached.change>0?'+':'')+cached.change.toFixed(2)+'% (24h)';

                // Update desktop
                document.getElementById('btcPrice').textContent = priceText;
                const e=document.getElementById('btcChange');
                e.textContent = changeText;
                e.className='btc-change';  // Keep gray, no color change

                // Update mobile
                document.getElementById('btcPriceMobile').textContent = priceText;
                const eMobile=document.getElementById('btcChangeMobile');
                eMobile.textContent = changeText;
                eMobile.className='btc-change';  // Keep gray, no color change
                return;
            }

            try{
                const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                const d=await r.json();
                if (!d.bitcoin) throw new Error('Invalid data');
                const p=d.bitcoin.usd,c=d.bitcoin.usd_24h_change;

                // Cache the result
                apiCache.btcPrice = { data: { price: p, change: c }, timestamp: Date.now() };

                const priceText = '$'+p.toLocaleString('en-US',{maximumFractionDigits:0});
                const changeText = (c>0?'+':'')+c.toFixed(2)+'% (24h)';

                // Update desktop
                document.getElementById('btcPrice').textContent = priceText;
                const e=document.getElementById('btcChange');
                e.textContent = changeText;
                e.className='btc-change';  // Keep gray, no color change

                // Update mobile
                document.getElementById('btcPriceMobile').textContent = priceText;
                const eMobile=document.getElementById('btcChangeMobile');
                eMobile.textContent = changeText;
                eMobile.className='btc-change';  // Keep gray, no color change
            }catch(e){
                console.error('BTC price error:',e);
                // Retry with alternative API
                try {
                    const r2 = await fetch('https://api.coincap.io/v2/assets/bitcoin');
                    const d2 = await r2.json();
                    const p = parseFloat(d2.data.priceUsd);
                    const c = parseFloat(d2.data.changePercent24Hr);

                    // Cache the fallback result
                    apiCache.btcPrice = { data: { price: p, change: c }, timestamp: Date.now() };

                    const priceText = '$'+p.toLocaleString('en-US',{maximumFractionDigits:0});
                    const changeText = (c>0?'+':'')+c.toFixed(2)+'% (24h)';

                    // Update desktop
                    document.getElementById('btcPrice').textContent = priceText;
                    const e2=document.getElementById('btcChange');
                    e2.textContent = changeText;
                    e2.className='btc-change';  // Keep gray, no color change

                    // Update mobile
                    document.getElementById('btcPriceMobile').textContent = priceText;
                    const e2Mobile=document.getElementById('btcChangeMobile');
                    e2Mobile.textContent = changeText;
                    e2Mobile.className='btc-change';  // Keep gray, no color change
                } catch(e2) {
                    console.error('Fallback BTC price error:',e2);
                    document.getElementById('btcPrice').textContent='Price unavailable';
                    document.getElementById('btcChange').textContent='';
                    document.getElementById('btcPriceMobile').textContent='Price unavailable';
                    document.getElementById('btcChangeMobile').textContent='';
                }
            }
        }

        async function fetchBTCDominance() {
            const globalData = await fetchGlobalData();
            if (globalData && globalData.market_cap_percentage && globalData.market_cap_percentage.btc) {
                const dominance = globalData.market_cap_percentage.btc;
                const dominanceText = dominance.toFixed(2) + '%';
                document.getElementById('btcDominance').textContent = dominanceText;
                document.getElementById('btcDominanceMobile').textContent = dominanceText;
            } else {
                document.getElementById('btcDominance').textContent = 'N/A';
                document.getElementById('btcDominanceMobile').textContent = 'N/A';
            }
        }

        async function fetchBTCMarketCap() {
            const globalData = await fetchGlobalData();
            if (globalData && globalData.total_market_cap && globalData.total_market_cap.usd && globalData.market_cap_percentage && globalData.market_cap_percentage.btc) {
                const totalMarketCap = globalData.total_market_cap.usd;
                const btcDominance = globalData.market_cap_percentage.btc;

                // Calculate BTC market cap: Total Market Cap Ã— (BTC Dominance / 100)
                const btcMarketCap = totalMarketCap * (btcDominance / 100);

                // Format market cap
                let formatted;
                if (btcMarketCap >= 1e12) {
                    formatted = '$' + (btcMarketCap / 1e12).toFixed(2) + 'T';
                } else if (btcMarketCap >= 1e9) {
                    formatted = '$' + (btcMarketCap / 1e9).toFixed(2) + 'B';
                } else {
                    formatted = '$' + (btcMarketCap / 1e6).toFixed(2) + 'M';
                }

                document.getElementById('btcMarketCap').textContent = formatted;
                document.getElementById('btcMarketCapMobile').textContent = formatted;
                console.log('BTC Market Cap updated:', formatted);
            } else {
                console.error('Invalid market cap data');
                document.getElementById('btcMarketCap').textContent = 'N/A';
                document.getElementById('btcMarketCapMobile').textContent = 'N/A';
            }
        }

        async function fetchHistoricalData(){
            try{
                // Fetch FGI data
                const fgiResponse=await fetch('https://api.alternative.me/fng/?limit=30&format=json');
                if (!fgiResponse.ok) throw new Error(`HTTP ${fgiResponse.status}`);
                const fgiData=await fgiResponse.json();

                // Fetch BTC price data
                const btcResponse=await fetch('https://min-api.cryptocompare.com/data/v2/histoday?fsym=BTC&tsym=USD&limit=30');
                if (!btcResponse.ok) throw new Error(`HTTP ${btcResponse.status}`);
                const btcData=await btcResponse.json();

                if(fgiData.data&&Array.isArray(fgiData.data)&&fgiData.data.length>0&&btcData.Data&&btcData.Data.Data){
                    const fgiHistory=fgiData.data.reverse();
                    const btcHistory=btcData.Data.Data;

                    // Merge FGI and BTC data by matching timestamps
                    const history=fgiHistory.map(item=>{
                        const btcItem=btcHistory.find(b=>b.time===parseInt(item.timestamp));
                        return {
                            date:new Date(item.timestamp*1000).toLocaleDateString('en-US',{month:'short',day:'numeric'}),
                            score:parseInt(item.value),
                            timestamp:item.timestamp,
                            btcPrice:btcItem?btcItem.close:null
                        };
                    });
                    renderChart(history);
                    renderDistributionChart(history);
                }else{
                    throw new Error('No historical data available');
                }
            }catch(e){
                console.error('History error:',e);
                document.getElementById('chartTitle').innerHTML='30-Day Sentiment History - <span style="color:#ff6666">Connection Error</span>';
            }
        }

        function renderDistributionChart(history){
            const el=document.getElementById('distributionChart');
            if(!el||typeof Chart==='undefined')return;

            // Calculate distribution
            const distribution={
                extremeFear:0,  // 0-24
                fear:0,         // 25-44
                neutral:0,      // 45-55
                greed:0,        // 56-75
                extremeGreed:0  // 76-100
            };

            history.forEach(item=>{
                const score=item.score;
                if(score<=24) distribution.extremeFear++;
                else if(score<=44) distribution.fear++;
                else if(score<=55) distribution.neutral++;
                else if(score<=75) distribution.greed++;
                else distribution.extremeGreed++;
            });

            const total=history.length;
            const data=[
                distribution.extremeFear,
                distribution.fear,
                distribution.neutral,
                distribution.greed,
                distribution.extremeGreed
            ];

            const percentages=data.map(val=>((val/total)*100).toFixed(1));

            if(window.distributionChartInstance){
                window.distributionChartInstance.destroy();
            }

            const ctx=el.getContext('2d');
            window.distributionChartInstance=new Chart(ctx,{
                type:'doughnut',
                data:{
                    labels:[
                        `Extreme Fear ðŸ’€ (${percentages[0]}%)`,
                        `Fear ðŸ˜± (${percentages[1]}%)`,
                        `Neutral ðŸ˜ (${percentages[2]}%)`,
                        `Greed ðŸ˜ (${percentages[3]}%)`,
                        `Extreme Greed ðŸ¤‘ (${percentages[4]}%)`
                    ],
                    datasets:[{
                        data:data,
                        backgroundColor:[
                            '#ff3366',  // Extreme Fear - Red
                            '#ff8844',  // Fear - Orange
                            '#ffd700',  // Neutral - Yellow
                            '#7cfc00',  // Greed - Light Green
                            '#39ff14'   // Extreme Greed - Neon Green
                        ],
                        borderColor:'#0a0e14',
                        borderWidth:3
                    }]
                },
                options:{
                    responsive:true,
                    maintainAspectRatio:true,
                    plugins:{
                        legend:{
                            position:'bottom',
                            labels:{
                                color:'#e6e8eb',
                                font:{
                                    size:12,
                                    family:'Chakra Petch'
                                },
                                padding:15,
                                usePointStyle:true,
                                pointStyle:'circle'
                            }
                        },
                        tooltip:{
                            backgroundColor:'rgba(10, 14, 20, 0.95)',
                            titleColor:'#39ff14',
                            bodyColor:'#e6e8eb',
                            borderColor:'#39ff14',
                            borderWidth:1,
                            padding:12,
                            displayColors:true,
                            callbacks:{
                                label:function(context){
                                    const days=context.parsed;
                                    const percentage=percentages[context.dataIndex];
                                    return ` ${days} days (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderChart(h){
            const el=document.getElementById('historyChart');
            if(!el||typeof Chart==='undefined')return;
            const c=el.getContext('2d');
            if(window.chartInstance)window.chartInstance.destroy();
            const isMobile=window.innerWidth<=768;
            try{
                window.chartInstance=new Chart(c,{
                    type:'line',
                    data:{
                        labels:h.map(d=>d.date),
                        datasets:[
                            {
                                label:'Fear & Greed',
                                data:h.map(d=>d.score),
                                borderColor:'#00ff00',
                                backgroundColor:'rgba(0,255,0,0.1)',
                                borderWidth:3,
                                tension:0.4,
                                fill:true,
                                pointBackgroundColor:h.map(d=>getColorForScore(d.score)),
                                pointBorderColor:'#fff',
                                pointBorderWidth:2,
                                pointRadius:isMobile?3:5,
                                pointHoverRadius:isMobile?5:7,
                                yAxisID:'y'
                            },
                            {
                                label:'BTC Price',
                                data:h.map(d=>d.btcPrice),
                                borderColor:'#ffd700',
                                backgroundColor:'rgba(255,215,0,0.1)',
                                borderWidth:2,
                                tension:0.4,
                                fill:false,
                                pointBackgroundColor:'#ffd700',
                                pointBorderColor:'#fff',
                                pointBorderWidth:2,
                                pointRadius:isMobile?2:4,
                                pointHoverRadius:isMobile?4:6,
                                yAxisID:'y1'
                            }
                        ]
                    },
                    options:{
                        responsive:true,
                        maintainAspectRatio:true,
                        interaction:{
                            mode:'index',
                            intersect:false
                        },
                        plugins:{
                            legend:{labels:{color:'#00ff00',font:{family:'Courier New',size:isMobile?12:14}}},
                            tooltip:{
                                backgroundColor:'rgba(0,0,0,0.9)',
                                titleColor:'#00ff00',
                                bodyColor:'#fff',
                                borderColor:'#00ff00',
                                borderWidth:2,
                                padding:12,
                                displayColors:true,
                                titleFont:{family:'Courier New',size:14,weight:'bold'},
                                bodyFont:{family:'Courier New',size:13},
                                callbacks:{
                                    title:function(context){
                                        return context[0].label;
                                    },
                                    label:function(context){
                                        if(context.dataset.label==='Fear & Greed'){
                                            const score=context.parsed.y;
                                            const sentiment=getSentimentCategory(score);
                                            const emoji=getSymbolForScore(score);
                                            return emoji+' '+sentiment+': '+score+'/100';
                                        }else{
                                            return 'BTC: $'+context.parsed.y.toLocaleString('en-US',{maximumFractionDigits:0});
                                        }
                                    }
                                }
                            }
                        },
                        scales:{
                            y:{
                                type:'linear',
                                position:'left',
                                beginAtZero:true,
                                max:100,
                                grid:{color:'rgba(0,255,0,0.2)'},
                                ticks:{color:'#00ff00',font:{family:'Courier New',size:isMobile?9:11}},
                                title:{display:true,text:'FGI Score',color:'#00ff00',font:{family:'Courier New',size:isMobile?10:12}}
                            },
                            y1:{
                                type:'linear',
                                position:'right',
                                grid:{display:false},
                                ticks:{color:'#ffd700',font:{family:'Courier New',size:isMobile?9:11},callback:function(value){return '$'+value.toLocaleString('en-US',{maximumFractionDigits:0});}},
                                title:{display:true,text:'BTC Price',color:'#ffd700',font:{family:'Courier New',size:isMobile?10:12}}
                            },
                            x:{grid:{color:'rgba(0,255,0,0.1)'},ticks:{color:'#00ff00',font:{family:'Courier New',size:isMobile?8:11},maxRotation:45,minRotation:45,autoSkip:true,maxTicksLimit:isMobile?8:15}}
                        }
                    }
                });
            }catch(e){console.error('Chart error:',e);}
        }
        
        // Sentiment Streak Functions
        function getSentimentCategory(score) {
            if (score <= 25) return 'Extreme Fear';  // 0-25 (matches API)
            if (score <= 45) return 'Fear';          // 26-45
            if (score <= 54) return 'Neutral';       // 46-54
            if (score <= 74) return 'Greed';         // 55-74
            return 'Extreme Greed';                  // 75-100
        }

        async function fetchHistoricalStreakData() {
            try {
                const r = await fetch('https://api.alternative.me/fng/?limit=365&format=json');
                const d = await r.json();
                if (!d.data || !Array.isArray(d.data)) {
                    throw new Error('Invalid historical data');
                }
                return d.data; // Newest first (index 0 = today)
            } catch (e) {
                console.error('Historical streak data fetch error:', e);
                return null;
            }
        }

        function calculateCurrentStreak(historicalData, currentCategory) {
            let streak = 0;
            for (let i = 0; i < historicalData.length; i++) {
                const score = parseInt(historicalData[i].value);
                const category = getSentimentCategory(score);
                if (category === currentCategory) {
                    streak++;
                } else {
                    break; // Stop when category changes
                }
            }
            return streak;
        }

        function calculateHistoricalStats(historicalData) {
            const categories = ['Extreme Fear', 'Fear', 'Neutral', 'Greed', 'Extreme Greed'];
            const stats = {};

            categories.forEach(cat => {
                stats[cat] = { longestStreak: 0, totalDays: 0, streakCount: 0, recordDate: null };
            });

            // Track current streak as we iterate
            let currentCat = null;
            let currentStreakLen = 0;
            let streakStartIndex = 0;

            for (let i = historicalData.length - 1; i >= 0; i--) { // Go oldest to newest
                const score = parseInt(historicalData[i].value);
                const category = getSentimentCategory(score);

                if (category === currentCat) {
                    currentStreakLen++;
                } else {
                    // Save previous streak
                    if (currentCat && currentStreakLen > 0) {
                        if (currentStreakLen > stats[currentCat].longestStreak) {
                            stats[currentCat].longestStreak = currentStreakLen;
                            // Record the date when this streak ended (most recent day of the streak)
                            stats[currentCat].recordDate = historicalData[streakStartIndex].timestamp;
                        }
                        stats[currentCat].totalDays += currentStreakLen;
                        stats[currentCat].streakCount++;
                    }
                    // Start new streak
                    currentCat = category;
                    currentStreakLen = 1;
                    streakStartIndex = i;
                }
            }

            // Don't include the LAST streak because it's the CURRENT ONGOING streak
            // We only want COMPLETED historical streaks for comparison
            // (The last streak ends at index 0 which is today - still active!)

            // Calculate averages
            categories.forEach(cat => {
                if (stats[cat].streakCount > 0) {
                    stats[cat].average = Math.round((stats[cat].totalDays / stats[cat].streakCount) * 10) / 10;
                } else {
                    stats[cat].average = 0;
                }
            });

            return stats;
        }

        // Helper function to format timestamp to "Month Year"
        function formatRecordDate(timestamp) {
            if (!timestamp) return '';
            const date = new Date(parseInt(timestamp) * 1000);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        async function updateStreakDisplay(currentScore) {
            try {
                const historicalData = await fetchHistoricalStreakData();
                if (!historicalData || historicalData.length === 0) {
                    document.getElementById('streakInfo').textContent = '';
                    return;
                }

                const currentCategory = getSentimentCategory(currentScore);
                const currentStreak = calculateCurrentStreak(historicalData, currentCategory);
                const stats = calculateHistoricalStats(historicalData);

                const catStats = stats[currentCategory];
                const record = catStats.longestStreak;
                const average = catStats.average;
                const recordDate = catStats.recordDate;

                const streakInfoEl = document.getElementById('streakInfo');

                // Update the streak inline display (inside slot machine AND mobile box) for ALL sentiments
                const streakLabelInlineEl = document.getElementById('streakLabelInline');
                const streakValueInlineEl = document.getElementById('streakValueInline');
                const streakDescInlineEl = document.getElementById('streakDescInline');
                const streakLabelInlineMobileEl = document.getElementById('streakLabelInlineMobile');
                const streakValueInlineMobileEl = document.getElementById('streakValueInlineMobile');
                const streakDescInlineMobileEl = document.getElementById('streakDescInlineMobile');

                const streakColor = getColorForScore(currentScore);

                // Generate label based on current sentiment
                const streakLabel = `${currentCategory.toUpperCase()} STREAK`;

                // Generate description text
                let descText;
                const categoryLower = currentCategory.toLowerCase();
                if (currentStreak === 0) {
                    descText = `No active ${categoryLower} streak`;
                } else if (currentStreak === 1) {
                    descText = `Day 1 of ${categoryLower}`;
                } else {
                    descText = `${currentStreak} consecutive days of ${categoryLower}`;
                }

                // Update desktop
                if (streakLabelInlineEl) {
                    streakLabelInlineEl.textContent = streakLabel;
                }
                if (streakValueInlineEl) {
                    streakValueInlineEl.textContent = currentStreak;
                    streakValueInlineEl.style.color = streakColor;
                }
                if (streakDescInlineEl) {
                    streakDescInlineEl.textContent = descText;
                }

                // Update mobile
                if (streakLabelInlineMobileEl) {
                    streakLabelInlineMobileEl.textContent = streakLabel;
                }
                if (streakValueInlineMobileEl) {
                    streakValueInlineMobileEl.textContent = currentStreak;
                    streakValueInlineMobileEl.style.color = streakColor;
                }
                if (streakDescInlineMobileEl) {
                    streakDescInlineMobileEl.textContent = descText;
                }

                // Format record date string
                const recordDateStr = recordDate ? ` in ${formatRecordDate(recordDate)}` : '';

                // Check if it's a new record
                if (currentStreak > record) {
                    // BREAKING RECORD - current streak is longer than previous record
                    streakInfoEl.innerHTML = `Day ${currentStreak} of ${currentCategory} ðŸ”¥ RECORD BROKEN!${record > 0 ? ` (Previous: ${record} days${recordDateStr})` : ''}`;
                    streakInfoEl.classList.add('record');
                } else if (currentStreak === 1) {
                    // Just started
                    streakInfoEl.innerHTML = `Day 1 of ${currentCategory} (Just started!)`;
                    streakInfoEl.classList.remove('record');
                } else if (currentStreak < record && currentStreak >= record - 1 && record > 0) {
                    // Near record (within 1 day of breaking it, but NOT equal or greater)
                    streakInfoEl.innerHTML = `Day ${currentStreak} of ${currentCategory} (Near record! Longest: ${record} days${recordDateStr})`;
                    streakInfoEl.classList.remove('record');
                } else if (average > 0 && currentStreak > average * 1.3) {
                    // Above average
                    streakInfoEl.innerHTML = `Day ${currentStreak} of ${currentCategory} (Above avg! Typical: ${average} days | Record: ${record} days${recordDateStr})`;
                    streakInfoEl.classList.remove('record');
                } else {
                    // Normal
                    streakInfoEl.innerHTML = `Day ${currentStreak} of ${currentCategory} (Avg: ${average} days | Record: ${record} days${recordDateStr})`;
                    streakInfoEl.classList.remove('record');
                }
            } catch (e) {
                console.error('Streak display error:', e);
                document.getElementById('streakInfo').textContent = '';
            }
        }

        async function fetchData(){
            try{
                const r=await fetch('https://api.alternative.me/fng/?limit=1&format=json');
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                const d=await r.json();
                if(!d.data||!d.data[0]){throw new Error('Invalid API response');}
                const fgiData=d.data[0];
                currentScore=parseInt(fgiData.value);
                const statusMap={'Extreme Fear':'EXTREME FEAR','Fear':'FEAR','Neutral':'NEUTRAL','Greed':'GREED','Extreme Greed':'EXTREME GREED'};
                const status=statusMap[fgiData.value_classification]||fgiData.value_classification.toUpperCase();
                const degenMap={'Extreme Fear':'ðŸ’Ž Accumulate','Fear':'ðŸ¤” Good Entry','Neutral':'ðŸ˜ Wait & See','Greed':'ðŸš¨ Take Profits','Extreme Greed':'âš ï¸ Exit Now'};
                const degenStatus=degenMap[fgiData.value_classification]||'...';
                const color=getColorForScore(currentScore);
                updateSlotMachine(currentScore);
                document.getElementById('slotStatus').textContent=status;
                document.getElementById('slotStatus').style.color=color;
                document.getElementById('degenStatus').textContent=degenStatus;
                document.getElementById('degenStatus').style.color=color;
                document.getElementById('timestamp').textContent='> Last Updated: '+new Date(fgiData.timestamp*1000).toLocaleTimeString();
                updateSentimentQuote(currentScore, color);

                // Update streak display
                await updateStreakDisplay(currentScore);

                const extreme=currentScore<=20||currentScore>=80;
                if(extreme&&notificationsEnabled&&(lastNotificationScore===null||Math.abs(lastNotificationScore-currentScore)>10)){
                    new Notification(currentScore<=20?'ðŸ”¥ JACKPOT - EXTREME FEAR!':'âš ï¸ JACKPOT - EXTREME GREED!',{body:'Score: '+currentScore});
                    lastNotificationScore=currentScore;
                }else if(!extreme){lastNotificationScore=null;}

                // Update portfolio advice if portfolio exists
                if(portfolioData){
                    updatePortfolioAdvice();
                }
            }catch(e){
                console.error('Data fetch error:',e);
                document.getElementById('slotStatus').textContent='CONNECTION ERROR';
                document.getElementById('slotStatus').style.color='#ff0000';
                document.getElementById('degenStatus').textContent='ðŸ”„ Pull lever to retry';
                document.getElementById('degenStatus').style.color='#ffaa00';
                document.getElementById('quoteText').textContent='Unable to fetch data. Please try again.';
            }
        }
        
        function shareToX(){
            const s=currentScore<20?'BLOOD IN THE STREETS':currentScore<40?'PAPER HANDS EVERYWHERE':currentScore<60?'CRAB MARKET':currentScore<80?'FOMO KICKING IN':'EUPHORIA - TOP IS IN';
            const e=currentScore<20?'ðŸ”¥':currentScore<40?'ðŸ’Ž':currentScore<60?'ðŸ¦€':currentScore<80?'ðŸš€':'âš ï¸';
            const symbol=getSymbolForScore(currentScore);
            const t=e+' '+symbol+' Crypto F&G: '+currentScore+'/100\n\nStatus: '+s+'\n\nCheck it live:';
            window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(t)+'&url='+encodeURIComponent(window.location.href),'_blank','width=550,height=420');
        }
        
        function refreshAll(){
            fetchData();
            fetchBTCPrice();
            fetchBTCDominance();
            fetchBTCMarketCap();
            fetchHistoricalData();
        }

        // Initial load - fetch BTC data and chart, but NOT slot machine
        // Slot machine only spins when user clicks SPIN button
        fetchBTCPrice();
        fetchBTCDominance();
        fetchBTCMarketCap();
        fetchHistoricalData();

        // No auto-refresh - only update when user spins the slot

        // Portfolio Management
        let portfolioData = null;
        let allocationChartInstance = null;

        function loadPortfolio() {
            const saved = localStorage.getItem('portfolio');
            if (saved) {
                portfolioData = JSON.parse(saved);
                return portfolioData;
            }
            return null;
        }

        function savePortfolio() {
            const crypto = parseFloat(document.getElementById('cryptoInput').value) || 0;
            const stablecoins = parseFloat(document.getElementById('stablesInput').value) || 0;

            // Validate for negative values
            if (crypto < 0 || stablecoins < 0) {
                alert('Please enter positive values only. Negative amounts are not allowed.');
                return;
            }

            if (crypto === 0 && stablecoins === 0) {
                alert('Please enter at least one value');
                return;
            }

            portfolioData = { crypto, stablecoins };
            localStorage.setItem('portfolio', JSON.stringify(portfolioData));

            renderAllocationChart();
            updatePortfolioAdvice();
        }

        function calculateAllocation() {
            if (!portfolioData) return null;
            const total = portfolioData.crypto + portfolioData.stablecoins;
            if (total === 0) return null;

            return {
                cryptoRatio: portfolioData.crypto / total,
                stablesRatio: portfolioData.stablecoins / total,
                total: total
            };
        }

        function getPortfolioAdvice(fgiScore, cryptoRatio) {
            // Extreme Fear (0-25) + High Cash (cryptoRatio < 30%)
            if (fgiScore <= 25 && cryptoRatio < 0.3) {
                return {
                    text: "Deploy your cash - great entry point!",
                    color: "#44ff88",
                    borderColor: "#44ff88"
                };
            }

            // Extreme Greed (75-100) + High Crypto (cryptoRatio > 70%)
            if (fgiScore >= 75 && cryptoRatio > 0.7) {
                return {
                    text: "Take profits - you're overexposed!",
                    color: "#ff4444",
                    borderColor: "#ff4444"
                };
            }

            // Fear (26-45) + Low Crypto (opportunity)
            if (fgiScore <= 45 && cryptoRatio < 0.4) {
                return {
                    text: "Good time to increase crypto allocation",
                    color: "#88ff44",
                    borderColor: "#88ff44"
                };
            }

            // Greed (55-74) + High Crypto (warning)
            if (fgiScore >= 55 && cryptoRatio > 0.6) {
                return {
                    text: "Consider taking some profits",
                    color: "#ff8844",
                    borderColor: "#ff8844"
                };
            }

            // Balanced
            return {
                text: "Your allocation looks good",
                color: "#ffd700",
                borderColor: "#ffd700"
            };
        }

        function updatePortfolioAdvice() {
            const allocation = calculateAllocation();
            if (!allocation || currentScore === 0) return;

            const advice = getPortfolioAdvice(currentScore, allocation.cryptoRatio);
            const adviceElement = document.getElementById('portfolioAdvice');
            const adviceCardElement = document.getElementById('portfolioAdviceCard');
            const adviceText = document.getElementById('adviceText');

            adviceText.textContent = advice.text;
            adviceText.style.color = advice.color;

            // Show the card when there's portfolio advice
            if (adviceCardElement) adviceCardElement.style.display = 'block';
            if (adviceElement) adviceElement.style.display = 'block';
        }

        function renderAllocationChart() {
            if (!portfolioData) return;

            const allocation = calculateAllocation();
            if (!allocation) return;

            document.getElementById('portfolioChart').style.display = 'block';

            const ctx = document.getElementById('allocationChart').getContext('2d');

            if (allocationChartInstance) {
                allocationChartInstance.destroy();
            }

            allocationChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Crypto', 'Stablecoins'],
                    datasets: [{
                        data: [portfolioData.crypto, portfolioData.stablecoins],
                        backgroundColor: ['#f7931a', '#26a17b'],
                        borderColor: ['#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#00ff00',
                                font: {
                                    family: 'Courier New',
                                    size: 12
                                },
                                padding: 15
                            }
                        }
                    }
                }
            });

            // Display allocation stats
            const statsHTML = `
                <div class="stat-item">
                    <span class="stat-label">Crypto:</span>
                    <span class="stat-value">$${portfolioData.crypto.toLocaleString()} (${(allocation.cryptoRatio * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Stablecoins:</span>
                    <span class="stat-value">$${portfolioData.stablecoins.toLocaleString()} (${(allocation.stablesRatio * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item" style="margin-top:10px;border-top:2px solid rgba(0,255,0,0.5);padding-top:10px;">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value">$${allocation.total.toLocaleString()}</span>
                </div>
            `;
            document.getElementById('allocationStats').innerHTML = statsHTML;
        }

        // Initialize modal handlers after DOM is ready
        function initPortfolioModal() {
            const modal = document.getElementById('portfolioModal');
            const portfolioBtn = document.getElementById('portfolioToggle');
            const closeBtn = document.getElementsByClassName('close')[0];
            const saveBtn = document.getElementById('savePortfolioBtn');

            if (!modal || !portfolioBtn || !closeBtn || !saveBtn) {
                console.error('Portfolio modal elements not found', {modal, portfolioBtn, closeBtn, saveBtn});
                return;
            }

            console.log('Portfolio modal initialized successfully');

            portfolioBtn.addEventListener('click', function() {
                console.log('Portfolio button clicked');
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                portfolioBtn.setAttribute('aria-pressed', 'true');
                const saved = loadPortfolio();
                if (saved) {
                    document.getElementById('cryptoInput').value = saved.crypto;
                    document.getElementById('stablesInput').value = saved.stablecoins;
                    renderAllocationChart();
                }
                // Focus first input for keyboard users
                document.getElementById('cryptoInput').focus();
            });

            const closeModal = function() {
                console.log('Modal closed');
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                portfolioBtn.setAttribute('aria-pressed', 'false');
                portfolioBtn.focus(); // Return focus to trigger button
            };

            closeBtn.addEventListener('click', closeModal);

            // Keyboard support for close button
            closeBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    closeModal();
                }
            });

            // ESC key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            saveBtn.addEventListener('click', function() {
                console.log('Save button clicked');
                savePortfolio();
            });

            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    closeModal();
                }
            });
        }

        // Load portfolio on page load
        loadPortfolio();

        // Initialize modal immediately (modal is now defined before script)
        initPortfolioModal();

        // Initialize Backtester Modal
        function initBacktesterModal() {
            const modal = document.getElementById('backtesterModal');
            const backtesterBtn = document.getElementById('backtesterToggle');
            const closeBtn = modal?.querySelector('.close');

            if (!modal || !backtesterBtn || !closeBtn) {
                console.error('Backtester modal elements not found');
                return;
            }

            // Strategy data
            const strategyData = {
                greed: {
                    1: {roi: 1.38, samples: 92, winRate: 63.0, days: 100.0},
                    2: {roi: 1.95, samples: 61, winRate: 65.6, days: 103.2},
                    3: {roi: 2.44, samples: 41, winRate: 68.3, days: 104.4},
                    4: {roi: 5.52, samples: 31, winRate: 64.5, days: 110.5},
                    5: {roi: 5.06, samples: 26, winRate: 69.2, days: 110.3},
                    6: {roi: 9.46, samples: 23, winRate: 69.6, days: 100.2},
                    7: {roi: 5.55, samples: 19, winRate: 68.4, days: 113.2},
                    8: {roi: 7.95, samples: 15, winRate: 66.7, days: 117.3},
                    9: {roi: 8.12, samples: 13, winRate: 61.5, days: 112.9},
                    10: {roi: 8.22, samples: 12, winRate: 58.3, days: 115.8},
                    11: {roi: 5.65, samples: 12, winRate: 58.3, days: 114.8},
                    12: {roi: 13.02, samples: 10, winRate: 70.0, days: 102.8},
                    13: {roi: 12.76, samples: 9, winRate: 66.7, days: 112.4},
                    14: {roi: 15.25, samples: 9, winRate: 77.8, days: 111.4},
                    15: {roi: 20.27, samples: 8, winRate: 75.0, days: 103.4},
                    16: {roi: 16.43, samples: 7, winRate: 85.7, days: 107.9},
                    17: {roi: 15.76, samples: 6, winRate: 83.3, days: 105.2},
                    18: {roi: 19.14, samples: 6, winRate: 83.3, days: 104.2},
                    19: {roi: 21.31, samples: 5, winRate: 80.0, days: 121.6},
                    20: {roi: 22.58, samples: 4, winRate: 75.0, days: 126.8}
                },
                extremeGreed: {
                    1: {roi: 69.26, samples: 88, winRate: 100.0, days: 393.3},
                    2: {roi: 74.96, samples: 57, winRate: 100.0, days: 357.3},
                    3: {roi: 83.74, samples: 39, winRate: 100.0, days: 343.1},
                    4: {roi: 93.42, samples: 30, winRate: 100.0, days: 348.8},
                    5: {roi: 94.87, samples: 26, winRate: 100.0, days: 364.1},
                    6: {roi: 102.18, samples: 23, winRate: 100.0, days: 334.2},
                    7: {roi: 102.09, samples: 19, winRate: 100.0, days: 339.7},
                    8: {roi: 103.53, samples: 15, winRate: 100.0, days: 359.3},
                    9: {roi: 109.50, samples: 13, winRate: 100.0, days: 369.4},
                    10: {roi: 112.47, samples: 12, winRate: 100.0, days: 386.9},
                    11: {roi: 109.94, samples: 12, winRate: 100.0, days: 385.9},
                    12: {roi: 121.08, samples: 10, winRate: 100.0, days: 404.5},
                    13: {roi: 126.33, samples: 9, winRate: 100.0, days: 438.7},
                    14: {roi: 129.56, samples: 9, winRate: 100.0, days: 437.7},
                    15: {roi: 139.61, samples: 8, winRate: 100.0, days: 455.6},
                    16: {roi: 118.24, samples: 7, winRate: 100.0, days: 454.1},
                    17: {roi: 102.35, samples: 6, winRate: 100.0, days: 443.5},
                    18: {roi: 108.47, samples: 6, winRate: 100.0, days: 442.5},
                    19: {roi: 125.97, samples: 5, winRate: 100.0, days: 444.2},
                    20: {roi: 102.42, samples: 4, winRate: 100.0, days: 431.5}
                }
            };

            let selectedDay = 1;
            let investmentAmount = 1000;

            // Setup day slider
            const daySlider = modal.querySelector('#daySlider');
            const dayValue = modal.querySelector('#dayValue');
            if (daySlider && dayValue) {
                daySlider.addEventListener('input', (e) => {
                    selectedDay = parseInt(e.target.value);
                    dayValue.textContent = selectedDay;
                    updateDisplay();
                });
            }

            function updateDisplay() {
                const greed = strategyData.greed[selectedDay];
                const xgreed = strategyData.extremeGreed[selectedDay];

                modal.querySelector('#greed-samples').textContent = `${greed.samples} trades`;
                modal.querySelector('#greed-roi').textContent = `+${greed.roi.toFixed(2)}%`;
                modal.querySelector('#greed-winrate').textContent = `${greed.winRate.toFixed(1)}%`;
                modal.querySelector('#greed-days').textContent = `~${Math.round(greed.days)} days`;
                modal.querySelector('#greed-profit').textContent = `$${Math.round(investmentAmount * (1 + greed.roi / 100)).toLocaleString()}`;

                modal.querySelector('#xgreed-samples').textContent = `${xgreed.samples} trades`;
                modal.querySelector('#xgreed-roi').textContent = `+${xgreed.roi.toFixed(2)}%`;
                modal.querySelector('#xgreed-winrate').textContent = `${xgreed.winRate.toFixed(1)}%`;
                modal.querySelector('#xgreed-days').textContent = `~${Math.round(xgreed.days)} days`;
                modal.querySelector('#xgreed-profit').textContent = `$${Math.round(investmentAmount * (1 + xgreed.roi / 100)).toLocaleString()}`;

                modal.querySelector('#hodl-invest').textContent = `$${investmentAmount.toLocaleString()}`;
                modal.querySelector('#hodl-profit').textContent = `$${Math.round(investmentAmount * (1 - 0.0113)).toLocaleString()}`;
            }

            // Slider handler
            const slider = modal.querySelector('#investmentSlider');
            const valueDisplay = modal.querySelector('#investmentValue');

            slider.addEventListener('input', function() {
                investmentAmount = parseInt(this.value);
                valueDisplay.textContent = investmentAmount.toLocaleString();
                updateDisplay();
            });

            // Open modal
            backtesterBtn.addEventListener('click', function() {
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                backtesterBtn.setAttribute('aria-pressed', 'true');
                updateDisplay();
            });

            // Close modal
            const closeModal = function() {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                backtesterBtn.setAttribute('aria-pressed', 'false');
                backtesterBtn.focus();
            };

            closeBtn.addEventListener('click', closeModal);

            closeBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    closeModal();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    closeModal();
                }
            });

            // Initialize display
            updateDisplay();
        }

        initBacktesterModal();

        // Hindsight Score Data and Functions
        const hindsightData = {
            "Extreme Fear": {
                "day7": { avgReturn: 1.11, winRate: 52.2, wins: 147, total: 275, best: 40.35, worst: -23.94 },
                "day14": { avgReturn: 1.44, winRate: 53.1, wins: 146, total: 275, best: 58.40, worst: -28.42 },
                "day30": { avgReturn: -0.85, winRate: 48.4, wins: 133, total: 275, best: 56.94, worst: -37.41 }
            },
            "Fear": {
                "day7": { avgReturn: 2.32, winRate: 57.0, wins: 251, total: 440, best: 32.74, worst: -16.67 },
                "day14": { avgReturn: 3.33, winRate: 56.8, wins: 250, total: 440, best: 50.68, worst: -22.65 },
                "day30": { avgReturn: 4.54, winRate: 56.8, wins: 250, total: 440, best: 74.11, worst: -30.99 }
            },
            "Neutral": {
                "day7": { avgReturn: 1.86, winRate: 53.1, wins: 230, total: 433, best: 27.03, worst: -15.05 },
                "day14": { avgReturn: 3.71, winRate: 56.4, wins: 244, total: 433, best: 42.62, worst: -22.50 },
                "day30": { avgReturn: 6.82, winRate: 59.6, wins: 258, total: 433, best: 79.08, worst: -26.30 }
            },
            "Greed": {
                "day7": { avgReturn: 0.67, winRate: 50.5, wins: 339, total: 671, best: 21.58, worst: -18.26 },
                "day14": { avgReturn: 2.04, winRate: 52.2, wins: 350, total: 671, best: 34.61, worst: -22.60 },
                "day30": { avgReturn: 3.97, winRate: 50.8, wins: 341, total: 671, best: 68.67, worst: -32.21 }
            },
            "Extreme Greed": {
                "day7": { avgReturn: 5.08, winRate: 63.6, wins: 96, total: 151, best: 32.74, worst: -17.12 },
                "day14": { avgReturn: 10.42, winRate: 69.5, wins: 105, total: 151, best: 57.89, worst: -20.28 },
                "day30": { avgReturn: 21.87, winRate: 74.8, wins: 113, total: 151, best: 120.47, worst: -28.90 }
            }
        };

        function getFGIRange(score) {
            if (score <= 24) return 'Extreme Fear';
            if (score <= 44) return 'Fear';
            if (score <= 59) return 'Neutral';
            if (score <= 79) return 'Greed';
            return 'Extreme Greed';
        }

        function getReturnColor(value) {
            if (value > 10) return '#44ff88';
            if (value > 5) return '#88ff44';
            if (value > 0) return '#ffd700';
            if (value > -5) return '#ff8844';
            return '#ff4444';
        }

        function updateHindsightModal(score) {
            const range = getFGIRange(score);
            const data = hindsightData[range];

            // Update current range badge
            document.getElementById('currentRangeBadge').textContent = `Current Range: ${range} (${score})`;

            // Update time period cards
            const day7 = data.day7;
            const day14 = data.day14;
            const day30 = data.day30;

            document.getElementById('return7d').textContent = (day7.avgReturn > 0 ? '+' : '') + day7.avgReturn.toFixed(2) + '%';
            document.getElementById('return7d').style.color = getReturnColor(day7.avgReturn);
            document.getElementById('winrate7d').textContent = `Win Rate: ${day7.winRate.toFixed(1)}% (${day7.wins}/${day7.total})`;

            document.getElementById('return14d').textContent = (day14.avgReturn > 0 ? '+' : '') + day14.avgReturn.toFixed(2) + '%';
            document.getElementById('return14d').style.color = getReturnColor(day14.avgReturn);
            document.getElementById('winrate14d').textContent = `Win Rate: ${day14.winRate.toFixed(1)}% (${day14.wins}/${day14.total})`;

            document.getElementById('return30d').textContent = (day30.avgReturn > 0 ? '+' : '') + day30.avgReturn.toFixed(2) + '%';
            document.getElementById('return30d').style.color = getReturnColor(day30.avgReturn);
            document.getElementById('winrate30d').textContent = `Win Rate: ${day30.winRate.toFixed(1)}% (${day30.wins}/${day30.total})`;

            // Update historical stats
            document.getElementById('bestCase').textContent = '+' + day30.best.toFixed(2) + '%';
            document.getElementById('bestCase').style.color = '#44ff88';
            document.getElementById('worstCase').textContent = day30.worst.toFixed(2) + '%';
            document.getElementById('worstCase').style.color = '#ff4444';
            document.getElementById('sampleSize').textContent = day30.total + ' occurrences';

            // Update insight
            updateHindsightInsight(range, day30);

            // Update comparison table
            updateComparisonTable(range);
        }

        function updateHindsightInsight(range, data) {
            let insight = '';

            if (range === 'Extreme Fear') {
                insight = `Historically, Extreme Fear has shown mixed results with a slight negative bias (-0.85% avg over 30 days). While contrarian wisdom suggests buying during fear, the data shows this range often precedes further declines. Best case: +${data.best.toFixed(0)}%, Worst case: ${data.worst.toFixed(0)}%.`;
            } else if (range === 'Fear') {
                insight = `Fear levels have historically been solid entry points, averaging +4.54% over 30 days with a 56.8% win rate. This range offers good risk/reward with less downside than Extreme Fear. Consider gradual accumulation.`;
            } else if (range === 'Neutral') {
                insight = `Neutral sentiment has performed surprisingly well, averaging +6.82% over 30 days (59.6% win rate). This contradicts the "buy fear" narrative - stable sentiment often leads to steady gains. Second-best performer overall.`;
            } else if (range === 'Greed') {
                insight = `Greed has shown moderate returns (+3.97% avg, 50.8% win rate). While not as strong as Neutral or Extreme Greed, it's still positive. The momentum strategy appears to work better than contrarian approaches.`;
            } else if (range === 'Extreme Greed') {
                insight = `ðŸš€ Extreme Greed is the TOP PERFORMER with +21.87% average returns and 74.8% win rate! This defies conventional wisdom - when everyone's greedy, BTC tends to go MUCH higher. Momentum > Contrarian. Best case: +${data.best.toFixed(0)}%!`;
            }

            document.getElementById('insightText').textContent = insight;
        }

        function updateComparisonTable(currentRange) {
            const tbody = document.getElementById('comparisonTableBody');
            tbody.innerHTML = '';

            const ranges = ['Extreme Fear', 'Fear', 'Neutral', 'Greed', 'Extreme Greed'];

            ranges.forEach(range => {
                const data = hindsightData[range];
                const row = document.createElement('tr');
                if (range === currentRange) {
                    row.classList.add('current-row');
                }

                row.innerHTML = `
                    <td>${range}</td>
                    <td style="color: ${getReturnColor(data.day7.avgReturn)}">${(data.day7.avgReturn > 0 ? '+' : '') + data.day7.avgReturn.toFixed(2)}%</td>
                    <td style="color: ${getReturnColor(data.day14.avgReturn)}">${(data.day14.avgReturn > 0 ? '+' : '') + data.day14.avgReturn.toFixed(2)}%</td>
                    <td style="color: ${getReturnColor(data.day30.avgReturn)}">${(data.day30.avgReturn > 0 ? '+' : '') + data.day30.avgReturn.toFixed(2)}%</td>
                    <td>${data.day30.winRate.toFixed(1)}%</td>
                    <td>${data.day30.total}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Hindsight Modal Handlers
        function initHindsightModal() {
            const modal = document.getElementById('hindsightModal');
            const hindsightBtn = document.getElementById('hindsightToggle');
            const closeBtn = document.querySelector('.hindsight-close');
            const comparisonToggle = document.getElementById('comparisonToggle');
            const comparisonTable = document.getElementById('comparisonTableContainer');

            if (!modal || !hindsightBtn || !closeBtn) {
                console.error('Hindsight modal elements not found');
                return;
            }

            hindsightBtn.addEventListener('click', function() {
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                hindsightBtn.setAttribute('aria-pressed', 'true');

                // Update with current score
                if (currentScore > 0) {
                    updateHindsightModal(currentScore);
                }
            });

            const closeModal = function() {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                hindsightBtn.setAttribute('aria-pressed', 'false');
                hindsightBtn.focus();
            };

            closeBtn.addEventListener('click', closeModal);

            closeBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    closeModal();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            comparisonToggle.addEventListener('click', function() {
                comparisonTable.classList.toggle('visible');
                comparisonToggle.textContent = comparisonTable.classList.contains('visible')
                    ? 'ðŸ“Š Hide Comparison Table'
                    : 'ðŸ“Š Compare All FGI Ranges';
            });

            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    closeModal();
                }
            });
        }

        // Initialize hindsight modal
        initHindsightModal();

        // Add pulse animation to SPIN button on page load
        const spinBtn = document.getElementById('spinBtn');
        spinBtn.classList.add('pulse');

        // Add event listeners for all interactive elements (CSP-friendly)
        document.getElementById('spinBtn').addEventListener('click', function() {
            // Remove pulse animation after first click
            spinBtn.classList.remove('pulse');
            spinSlots();
        });

        // Keyboard support for spin button
        document.getElementById('spinBtn').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                // Remove pulse animation after first interaction
                spinBtn.classList.remove('pulse');
                spinSlots();
            }
        });

        document.getElementById('shareBtn').addEventListener('click', shareToX);

        // Keyboard support for share button
        document.getElementById('shareBtn').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                shareToX();
            }
        });

        document.getElementById('refreshBtn').addEventListener('click', refreshAll);

        // Keyboard support for refresh button
        document.getElementById('refreshBtn').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                refreshAll();
            }
        });

    </script>

    <!-- Mobile Footer Controls (only visible on mobile) -->
    <div class="controls-mobile" id="controlsMobile">
        <button class="hindsight-btn" aria-label="Hindsight Tool">ðŸ”®</button>
        <a href="https://t.me/fgichadbot" target="_blank" rel="noopener noreferrer" class="control-btn telegram-btn" aria-label="Telegram Alerts">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635.099-.002.321.023.465.14.121.098.155.23.171.324.016.094.036.308.02.475z"/>
            </svg>
        </a>
        <button class="control-btn" aria-label="Strategy Backtester">â™Ÿï¸</button>
        <button class="control-btn" aria-label="My Portfolio">ðŸ’¼</button>
    </div>

    <!-- Mobile footer button handlers - MUST run after HTML exists -->
    <script>
        // Mobile footer hide on scroll (like X/Twitter)
            let lastScrollTop = 0;
            const mobileFooter = document.getElementById('controlsMobile');

            if (mobileFooter) {
                // Set up click handlers for mobile footer buttons
                const mobileHindsightBtn = mobileFooter.querySelector('.hindsight-btn');
                const mobileButtons = mobileFooter.querySelectorAll('button.control-btn');
                const mobileBacktesterBtn = mobileButtons[0]; // â™Ÿï¸ Backtester button (first)
                const mobilePortfolioBtn = mobileButtons[1]; // ðŸ’¼ Portfolio button (second)

                // Hindsight button - open hindsight modal directly
                if (mobileHindsightBtn) {
                    mobileHindsightBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const modal = document.getElementById('hindsightModal');
                        const desktopBtn = document.getElementById('hindsightToggle');
                        if (modal && desktopBtn) {
                            modal.style.display = 'block';
                            modal.setAttribute('aria-hidden', 'false');
                            desktopBtn.setAttribute('aria-pressed', 'true');
                            if (currentScore > 0) {
                                updateHindsightModal(currentScore);
                            }
                        }
                    });
                }

                // Backtester button - open backtester modal directly
                if (mobileBacktesterBtn) {
                    mobileBacktesterBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const modal = document.getElementById('backtesterModal');
                        const desktopBtn = document.getElementById('backtesterToggle');
                        if (modal && desktopBtn) {
                            modal.style.display = 'block';
                            modal.setAttribute('aria-hidden', 'false');
                            desktopBtn.setAttribute('aria-pressed', 'true');
                        }
                    });
                }

                // Portfolio button - open portfolio modal directly
                if (mobilePortfolioBtn) {
                    mobilePortfolioBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const modal = document.getElementById('portfolioModal');
                        const desktopBtn = document.getElementById('portfolioToggle');
                        if (modal && desktopBtn) {
                            modal.style.display = 'block';
                            modal.setAttribute('aria-hidden', 'false');
                            desktopBtn.setAttribute('aria-pressed', 'true');
                            const saved = loadPortfolio();
                            if (saved) {
                                document.getElementById('cryptoInput').value = saved.crypto;
                                document.getElementById('stablesInput').value = saved.stablecoins;
                                renderAllocationChart();
                            }
                        }
                    });
                }

                // Scroll hide/show behavior
                if (window.innerWidth <= 800) {
                    window.addEventListener('scroll', function() {
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                        if (scrollTop > lastScrollTop && scrollTop > 100) {
                            // Scrolling down & past threshold - hide footer
                            mobileFooter.classList.add('hidden-scroll');
                        } else if (scrollTop < lastScrollTop) {
                            // Scrolling up - show footer
                            mobileFooter.classList.remove('hidden-scroll');
                        }

                        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                    }, false);
                }
            }
    </script>
</body>
</html>