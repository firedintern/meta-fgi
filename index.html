<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>> FEAR_GREED_PROTOCOL <</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: #000; color: #fff; min-height: 100vh; overflow-x: hidden; position: relative; }
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.15; }
        .container { text-align: center; max-width: 900px; width: 100%; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        .controls { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
        .control-btn { background: rgba(0, 255, 0, 0.2); border: 2px solid #00ff00; color: #00ff00; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-size: 1.2em; transition: all 0.3s ease; }
        .control-btn:hover { background: rgba(0, 255, 0, 0.4); transform: scale(1.1); }
        .control-btn.active { background: #00ff00; color: #000; box-shadow: 0 0 15px #00ff00; }
        .btc-ticker { background: linear-gradient(135deg, #f7931a 0%, #ffb74d 100%); padding: 15px 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(247, 147, 26, 0.3); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .btc-label { font-size: 0.9em; color: #000; opacity: 0.8; text-transform: uppercase; letter-spacing: 2px; font-weight: bold; }
        .btc-price { font-size: 2.5em; font-weight: bold; color: #000; margin: 5px 0; }
        .btc-change { font-size: 1.2em; font-weight: bold; margin-top: 5px; }
        .positive { color: #00ff00; }
        .negative { color: #ff0000; }
        .title { font-size: 2.2em; color: #00ff00; margin-bottom: 25px; font-weight: bold; letter-spacing: 3px; text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00; animation: terminal-flicker 3s ease-in-out infinite; }
        @keyframes terminal-flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.95; } }
        .gauge { width: 400px; height: 400px; margin: 30px auto; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); border-radius: 50%; border: 4px solid rgba(255,255,255,0.2); transition: all 0.5s ease; box-shadow: 0 0 30px rgba(0,0,0,0.5); padding: 40px; }
        .gauge.extreme { animation: extreme-pulse 1s ease-in-out infinite; }
        @keyframes extreme-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .score { font-size: 5.5em; font-weight: bold; text-shadow: 0 0 30px currentColor; margin-bottom: 10px; }
        .status { font-size: 1.1em; margin-top: 15px; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; line-height: 1.3; }
        .degen { font-size: 3em; font-family: 'Comic Sans MS', cursive, sans-serif; color: #fff; margin: 30px; font-weight: bold; text-shadow: 0 0 20px currentColor; animation: degen-bounce 2s ease-in-out infinite; }
        @keyframes degen-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .chart-container { background: rgba(255,255,255,0.05); border: 2px solid rgba(0, 255, 0, 0.3); border-radius: 15px; padding: 30px; margin: 40px 0; box-shadow: 0 0 20px rgba(0, 255, 0, 0.1); }
        .chart-title { color: #00ff00; font-size: 1.3em; margin-bottom: 20px; letter-spacing: 2px; text-transform: uppercase; }
        .btn { background: linear-gradient(135deg, #00ff00, #00cc00); border: 2px solid #00ff00; color: #000; padding: 15px 40px; font-size: 1.1em; border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; font-weight: bold; margin: 10px; text-transform: uppercase; letter-spacing: 2px; box-shadow: 0 0 15px rgba(0, 255, 0, 0.3); transition: all 0.3s ease; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(0, 255, 0, 0.6); }
        .share-btn { background: #000; border-color: #fff; color: #fff; display: inline-flex; align-items: center; gap: 10px; }
        .share-btn:hover { box-shadow: 0 0 25px rgba(255, 255, 255, 0.6); }
        .x-logo { width: 20px; height: 20px; filter: invert(1); }
        @media (max-width: 768px) { .title { font-size: 1.5em; } .degen { font-size: 2em; } .btc-price { font-size: 2em; } .gauge { width: 300px; height: 300px; padding: 30px; } .score { font-size: 4em; } .status { font-size: 0.9em; } .controls { top: 10px; right: 10px; flex-direction: column; } .chart-container { padding: 15px; } }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>
    <div class="controls">
        <button class="control-btn active" id="soundToggle" title="Toggle Music">ðŸ”Š</button>
        <button class="control-btn active" id="particlesToggle" title="Toggle Matrix Effect">âœ¨</button>
        <button class="control-btn" id="notifyToggle" title="Enable Browser Notifications (Alerts at Extreme Levels)">ðŸ””</button>
    </div>
    <div class="container">
        <div class="btc-ticker"><div class="btc-label">â‚¿ Bitcoin</div><div class="btc-price" id="btcPrice">Loading...</div><div class="btc-change" id="btcChange"></div></div>
        <div class="title">&gt; FEAR_GREED_PROTOCOL &lt;</div>
        <div id="content">Loading...</div>
        <div class="chart-container"><div class="chart-title">ðŸ“Š 30-Day Sentiment History</div><canvas id="historyChart"></canvas></div>
        <button class="btn share-btn" onclick="shareToX()">
            <svg class="x-logo" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            Share on X
        </button>
    </div>
    <audio id="bgMusic" loop></audio>
    <script>
        let currentScore=0,soundEnabled=true,particlesEnabled=true,notificationsEnabled=false,lastNotificationScore=null;
        const bgMusic=document.getElementById('bgMusic');
        
        // Music tracks for each state (YouTube embeds or Spotify links)
        const musicTracks = {
            extreme_fear: 'https://www.youtube.com/watch?v=04F4xlWSFh0',  // Dramatic/intense
            fear: 'https://www.youtube.com/watch?v=vr0NBPRMe2E',  // Chill/thoughtful
            neutral: 'https://www.youtube.com/watch?v=2WPCLda_erI',  // Ambient
            greed: 'https://www.youtube.com/watch?v=SSbBvKaM6sk',  // Upbeat
            extreme_greed: 'https://www.youtube.com/watch?v=ZnHmskwqCCQ'  // Party/euphoric
        };
        
        // Matrix effect
        const canvas=document.getElementById('matrix-canvas'),ctx=canvas.getContext('2d');
        canvas.width=window.innerWidth;canvas.height=window.innerHeight;
        const matrix="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%";
        const fontSize=14,columns=canvas.width/fontSize;
        const drops=[];
        for(let i=0;i<columns;i++)drops[i]=1;
        
        function drawMatrix(){
            if(!particlesEnabled)return;
            ctx.fillStyle='rgba(0,0,0,0.05)';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle='#0F0';
            ctx.font=fontSize+'px monospace';
            for(let i=0;i<drops.length;i++){
                const text=matrix[Math.floor(Math.random()*matrix.length)];
                ctx.fillText(text,i*fontSize,drops[i]*fontSize);
                if(drops[i]*fontSize>canvas.height&&Math.random()>0.975)drops[i]=0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix,35);
        
        window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});
        
        function getColorForScore(s){return s<20?'#ff4444':s<40?'#ff8844':s<60?'#ffd700':s<80?'#88ff44':'#44ff88';}
        
        function getMusicForScore(s){
            if(s<20)return musicTracks.extreme_fear;
            if(s<40)return musicTracks.fear;
            if(s<60)return musicTracks.neutral;
            if(s<80)return musicTracks.greed;
            return musicTracks.extreme_greed;
        }
        
        function playMusicForState(){
            if(!soundEnabled)return;
            // For now, just log which track would play
            // In production, you'd open the YouTube link or use an embed
            const track=getMusicForScore(currentScore);
            console.log('Playing track for score '+currentScore+': '+track);
            // You could open in new tab: window.open(track, '_blank');
        }
        
        document.getElementById('soundToggle').addEventListener('click',function(){
            soundEnabled=!soundEnabled;
            this.classList.toggle('active');
            this.textContent=soundEnabled?'ðŸ”Š':'ðŸ”‡';
            if(soundEnabled)playMusicForState();
        });
        
        document.getElementById('particlesToggle').addEventListener('click',function(){
            particlesEnabled=!particlesEnabled;
            this.classList.toggle('active');
            if(!particlesEnabled){ctx.fillStyle='rgba(0,0,0,1)';ctx.fillRect(0,0,canvas.width,canvas.height);}
        });
        
        document.getElementById('notifyToggle').addEventListener('click',async function(){
            if(!notificationsEnabled&&'Notification'in window){
                const p=await Notification.requestPermission();
                if(p==='granted'){
                    notificationsEnabled=true;
                    this.classList.add('active');
                    new Notification('ðŸ”” Alerts Enabled!',{body:'You will be notified when F&G hits extreme levels (<20 or >80)'});
                }
            }else{
                notificationsEnabled=false;
                this.classList.remove('active');
            }
        });
        
        async function fetchBTCPrice(){
            try{
                const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const d=await r.json();
                const p=d.bitcoin.usd,c=d.bitcoin.usd_24h_change;
                document.getElementById('btcPrice').textContent='$'+p.toLocaleString('en-US',{maximumFractionDigits:0});
                const e=document.getElementById('btcChange');
                e.textContent=(c>0?'+':'')+c.toFixed(2)+'% (24h)';
                e.className='btc-change '+(c>0?'positive':'negative');
            }catch(e){}
        }
        
        async function fetchHistoricalData(){
            try{
                const r=await fetch('/api/fgi?history=true');
                const d=await r.json();
                if(d.history&&d.history.length>0)renderChart(d.history);
            }catch(e){console.error('Chart error:',e);}
        }
        
        function renderChart(h){
            const c=document.getElementById('historyChart');
            if(!c)return;
            const ctx=c.getContext('2d');
            new Chart(ctx,{
                type:'line',
                data:{
                    labels:h.map(d=>d.date),
                    datasets:[{
                        label:'Fear & Greed Score',
                        data:h.map(d=>d.score),
                        borderColor:'#00ff00',
                        backgroundColor:'rgba(0,255,0,0.1)',
                        tension:0.4,
                        fill:true,
                        pointBackgroundColor:h.map(d=>getColorForScore(d.score)),
                        pointBorderColor:'#fff',
                        pointBorderWidth:2,
                        pointRadius:4
                    }]
                },
                options:{
                    responsive:true,
                    maintainAspectRatio:true,
                    plugins:{legend:{labels:{color:'#00ff00',font:{family:'Courier New',size:12}}}},
                    scales:{
                        y:{beginAtZero:true,max:100,grid:{color:'rgba(0,255,0,0.1)'},ticks:{color:'#00ff00',font:{family:'Courier New'}}},
                        x:{grid:{color:'rgba(0,255,0,0.1)'},ticks:{color:'#00ff00',font:{family:'Courier New',size:10},maxRotation:45,minRotation:45}}
                    }
                }
            });
        }
        
        async function fetchData(){
            try{
                const r=await fetch('/api/fgi');
                const d=await r.json();
                const prevScore=currentScore;
                currentScore=d.meta_score;
                const c=getColorForScore(currentScore);
                const e=currentScore<=20||currentScore>=80;
                
                // Play music when state changes
                if(prevScore!==currentScore)playMusicForState();
                
                if(e&&notificationsEnabled&&(lastNotificationScore===null||Math.abs(lastNotificationScore-currentScore)>10)){
                    new Notification(currentScore<=20?'ðŸ”¥ EXTREME FEAR!':'âš ï¸ EXTREME GREED!',{body:'Score: '+currentScore+(currentScore<=20?' - Time to accumulate?':' - Consider taking profits!')});
                    lastNotificationScore=currentScore;
                }else if(!e){lastNotificationScore=null;}
                
                document.getElementById('content').innerHTML='<div class="gauge '+(e?'extreme':'')+'" style="border-color:'+c+';"><div class="score" style="color:'+c+'">'+d.meta_score+'</div><div class="status" style="color:'+c+'">'+d.status+'</div></div><div class="degen" style="color:'+c+'">'+d.degen_status+'</div><button class="btn" onclick="refreshAll()">[  REFRESH  ]</button><div style="color:#00ff00;font-size:0.8em;opacity:0.6;">> '+new Date(d.timestamp).toLocaleTimeString()+'</div>';
            }catch(e){document.getElementById('content').innerHTML='<div style="color:#ff6b6b;">ERROR: '+e.message+'</div>';}
        }
        
        function shareToX(){
            const s=currentScore<20?'BLOOD IN THE STREETS':currentScore<40?'PAPER HANDS EVERYWHERE':currentScore<60?'CRAB MARKET':currentScore<80?'FOMO KICKING IN':'EUPHORIA - TOP IS IN';
            const e=currentScore<20?'ðŸ”¥':currentScore<40?'ðŸ’Ž':currentScore<60?'ðŸ¦€':currentScore<80?'ðŸš€':'âš ï¸';
            const t=e+' Crypto Fear & Greed: '+currentScore+'/100\n\nStatus: '+s+'\n\nCheck it live:';
            window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(t)+'&url='+encodeURIComponent(window.location.href),'_blank','width=550,height=420');
        }
        
        function refreshAll(){fetchData();fetchBTCPrice();fetchHistoricalData();}
        
        fetchData();
        fetchBTCPrice();
        fetchHistoricalData();
        setInterval(fetchBTCPrice,30000);
        setInterval(fetchData,60000);
    </script>
</body>
</html>